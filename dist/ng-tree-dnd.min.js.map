{"version":3,"sources":["ng-tree-dnd.js"],"names":["angular","isUndefinedOrNull","val","isUndefined","isDefined","module","constant","tree","empty","hidden","node","nodes","handle","place","drag","status","icon","1","0","-1","factory","$filter","_iF","_lenF","_keysF","_filter","_state","for_all_descendants","options","fieldChild","fnBefore","fnAfter","parentPassed","isFunction","_i","_len","_nodes","_nodePassed","_childPassed","length","_fnCheck","callback","check","isArray","_regex","RegExp","test","err","indexOf","_fnProccess","condition","isAnd","for_each_filter","_iO","_keysO","_lenO","_key","field","_callback","Object","keys","conditions","i","len","passed","_fnAfter","isNodePassed","isChildPassed","isParentPassed","__filtered__","__filtered_visible__","showParent","showChild","_fnBefore","filter","beginAnd","_fnConvert","filters","isObject","push","_fnMain","treeData","_options","_fnOrderBy","name","fnOrderBy","_fnOrder","list","orderBy","isString","_$initConvert","line2tree","data","primaryKey","parentKey","parentId","parent","rootIds","item","_primary","treeObjs","__children__","tree2tree","access_child","_copy","_child","_tree","copy","$document","$window","_$helper","nodrag","targetElm","attr","eventObj","e","obj","undefined","targetTouches","originalEvent","dragInfo","scope","_node","getData","getScopeTree","_parent","getNode","__parent_real__","move","pos","__index__","target","drop","getPrevSibling","changed","height","element","prop","width","offset","boundingClientRect","getBoundingClientRect","top","pageYOffset","body","scrollTop","documentElement","left","pageXOffset","scrollLeft","positionStarted","offsetX","pageX","this","offsetY","pageY","startX","lastX","startY","lastY","nowX","nowY","distX","distY","dirAx","dirX","dirY","lastDirX","lastDirY","distAxX","distAxY","positionMoved","firstMoving","newAx","Math","abs","moving","replaceIndent","indent","children","css","$callbacks","calsIndent","$injector","_fnget","has","get","$templateCache","temp","templatePath","copyPath","movePath","scopes","_$init","setMove","path","$id","setCopy","getPath","getCopy","getMove","directive","$compile","restrict","link","attrs","$watch","compile","new_val","new_elem","html","append","compileReplace","replaceWith","$element","$type","$class","addClass","replace","_enabledDragDrop","dragEnabled","dropEnabled","$modelValue","$icon_class","$node_class","treeDndNode","newValue","oldValue","setScope","__icon__","getScopeNode","getElementChilds","querySelector","$nodes_class","treeDndNodes","$timeout","$http","$TreeDnDTemplate","$TreeDnDClass","$TreeDnDHelper","$TreeDnDPlugin","controller","$scope","$attrs","indent_plus","indent_unit","$tree_class","primary_key","hasMultiSelect","onlyDeepestDrop","colDefinitions","$globals","tree_nodes","sycning","extend","iconExpand","iconCollapse","iconLeaf","fn","getLastDescendant","last_child","n","selected_node","onClick","on_click","setTimeout","onSelect","select_node","on_select","passedExpand","_clone","toggleExpand","fnCallback","expand","__expanded__","getHash","__parent__","__uid__","accept","moveTo","isChanged","level","skipUnit","skipEdge","unit","edge","droppable","draggable","beforeDrop","event","changeKey","random","__selected__","clone","_this","remove","splice","add","enableDrag","enableDrop","placeElm","horizontal","dragDelay","enabledMove","statusMove","enabledHotkey","enabledCollapse","statusElm","dragging","beforeDrag","scopeDrag","dragStop","skiped","dropped","info","pass","isMove","_nodeAdd","_move","_parentRemove","_parentAdd","dragStart","dragMove","setDragging","enableMove","enableStatus","enabledStatus","hideStatus","refreshStatus","statusElmOld","find","removeClass","setPositionStatus","z-index","targeting","_index","index","_hash","getScope","initPlace","dragElm","tagName","isTable","toLowerCase","document","createElement","_len_down","parentNode","insertBefore","hidePlace","showPlace","$safeApply","phase","$root","$$phase","$apply","tElement","tAttrs","$_Template","_element","trim","_fnInitFilter","_fnInitOrderBy","_fnGetControl","_fnInitDrag","w","_curW","_typeW","_nameW","_defaultW","_scopeW","_NotW","_AfterW","_BeforeW","getExpandOn","_firstNode","_keys","expandingProperty","getColDefs","_col_defs","do_f","root","parent_real","visible","_icon","_index_real","_dept","_hashKey","expandLevel","__index_real__","__level__","__visible__","__hashKey__","__dept__","reload_data","oData","_data","_tree_nodes","expandOn","columnDefs","filterOptions","_offset","_max","_min","_deptTotal","_defaultFilterOption","check_exist_attr","existAttr","for_each_attrs","exist","generateWatch","type","nameAttr","valDefault","nameScope","fnNotExist","old","_watches","isHotkey","templateCopy","_url","templateMove","treeClass","$tree","colDefs","_passed","enabledFilter","option","indentUnit","optCallbacks","forEach","value","key","lenW","templateUrl","cache","success","$rootScope","_fnDragEnd","holderWasShown","nodesSelected","lastSelectedNode","resetNodesSelected","__selected","_fnPlaceHolder","$params","_fnDragStart","hasTouch","button","which","uiTreeDragging","eventElm","eventScope","currentNode","$parent","includes","dragScope","eventElmTagName","_$scope","preventDefault","offsetEdge","_width","_scope","_needCollapse","_copied","_tbody","_holder","_swaper","after","bind","dragEndEvent","dragMoveEvent","dragCancelEvent","document_height","max","scrollHeight","offsetHeight","clientHeight","document_width","scrollWidth","offsetWidth","clientWidth","ctrlKey","shiftKey","groupNodes","lastSelectedNodeIdx","newSelectedNodeIdx","lowerIdx","higherIdx","idx","every","_fnDragMove","dragStarted","dragDelaying","getSelection","removeAllRanges","selection","leftElmPos","topElmPos","top_scroll","window","bottom_scroll","innerHeight","scrollBy","targetScope","targetBefore","targetOffset","isEmpty","isSwapped","_target","fnSwapTree","targetX","targetY","isVeritcal","_info","_drag","_drop","treeScope","isHolder","elementFromPoint","abortDrag","$$apply","_height","_prev","dragBorder","prepend","_isTable","_status","__multipleNodes","_fnBindDrag","unbind","_fnDragStartEvent","dragTimer","cancel","_fnKeydownHandler","keyCode","_fnKeyupHandler","bindDrag","dragEnd","keydownHandler","keyupHandler","$on","fnSetCollapse","fnSetExpand","expand_all_parents","deselect_node","get_parent","for_all_ancestors","child","add_node","new_node","add_node_root","expand_all","collapse_all","remove_node","expand_node","collapse_node","get_selected_node","get_first_node","get_children","get_siblings","get_next_sibling","get_prev_sibling","get_first_child","get_closest_ancestor_next_sibling","get_next_node","get_prev_node","get_last_descendant","select_parent_node","select_first_node","select_next_sibling","select_prev_sibling","select_next_node","select_prev_node","reset_selected_nodes","run","put","join","call"],"mappings":"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","file":"ng-tree-dnd.min.js","sourcesContent":["/**\r\n * The MIT License (MIT)\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to\r\n * deal in the Software without restriction, including without limitation the\r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n * @preserve\r\n */\r\n\r\n/**\r\n * Implementing TreeDnD & Event DrapnDrop (allow drag multi tree-table include all type: table, ol, ul)\r\n * Demo: http://thienhung1989.github.io/angular-tree-dnd\r\n * Github: https://github.com/thienhung1989/angular-tree-dnd\r\n * @version 3.2.1\r\n * @preserve\r\n * (c) 2015 Nguyuễn Thiện Hùng - <nguyenthienhung1989@gmail.com>\r\n */\r\n(function () {\r\n    'use strict';\r\n    angular.isUndefinedOrNull = function (val) {\r\n        return angular.isUndefined(val) || val === null;\r\n    }\r\n\r\n    angular.isDefined = function (val) {\r\n        return !(angular.isUndefined(val) || val === null);\r\n    }\r\n\r\n    angular.module('ntt.TreeDnD', ['template/TreeDnD/TreeDnD.html']).constant(\r\n        '$TreeDnDClass', {\r\n            tree:   'tree-dnd',\r\n            empty:  'tree-dnd-empty',\r\n            hidden: 'tree-dnd-hidden',\r\n            node:   'tree-dnd-node',\r\n            nodes:  'tree-dnd-nodes',\r\n            handle: 'tree-dnd-handle',\r\n            place:  'tree-dnd-placeholder',\r\n            drag:   'tree-dnd-drag',\r\n            status: 'tree-dnd-status',\r\n            icon:   {\r\n                '1':  'glyphicon glyphicon-minus',\r\n                '0':  'glyphicon glyphicon-plus',\r\n                '-1': 'glyphicon glyphicon-file'\r\n            }\r\n        }\r\n    ).factory(\r\n    '$TreeDnDFilter', [\r\n        '$filter', function ($filter) {\r\n            var _iF, _lenF, _keysF,\r\n                _filter,\r\n                _state,\r\n                for_all_descendants = function for_all_descendants(options, node, fieldChild, fnBefore, fnAfter, parentPassed) {\r\n                    if (!angular.isFunction(fnBefore)) {\r\n                        return null;\r\n                    }\r\n\r\n                    var _i, _len, _nodes,\r\n                        _nodePassed = fnBefore(options, node),\r\n                        _childPassed = false;\r\n\r\n                    if (angular.isDefined(node[fieldChild])) {\r\n                        _nodes = node[fieldChild];\r\n                        _len = _nodes.length;\r\n                        for (_i = 0; _i < _len; _i++) {\r\n                            _childPassed = for_all_descendants(\r\n                                options,\r\n                                _nodes[_i],\r\n                                fieldChild,\r\n                                fnBefore,\r\n                                fnAfter,\r\n                                _nodePassed || parentPassed\r\n                            ) || _childPassed;\r\n                        }\r\n                    }\r\n\r\n                    if (angular.isFunction(fnAfter)) {\r\n                        fnAfter(options, node, _nodePassed === true, _childPassed === true, parentPassed === true);\r\n                    }\r\n\r\n                    return _nodePassed || _childPassed;\r\n                },\r\n                // Check data by filter\r\n                _fnCheck = function _fnCheck(callback, check) {\r\n                    if (angular.isUndefinedOrNull(check) || angular.isArray(check)) {\r\n                        return null;\r\n                    }\r\n\r\n                    if (angular.isFunction(callback)) {\r\n                        return callback(check, $filter);\r\n                    } else {\r\n                        if (typeof callback === 'boolean') {\r\n                            check = !!check;\r\n                            return check === callback;\r\n                        } else if (angular.isDefined(callback)) {\r\n                            try {\r\n                                var _regex = new RegExp(callback);\r\n                                return _regex.test(check);\r\n                            }\r\n                            catch (err) {\r\n                                if (typeof check === 'string') {\r\n                                    return check.indexOf(callback) > -1;\r\n                                } else {\r\n                                    return null;\r\n                                }\r\n                            }\r\n                        } else {\r\n                            return null;\r\n                        }\r\n                    }\r\n                },\r\n                _fnProccess = function _fnProccess(node, condition, isAnd) {\r\n                    if (angular.isArray(condition)) {\r\n                        return for_each_filter(node, condition, isAnd);\r\n                    } else {\r\n                        var _key = condition.field,\r\n                            _callback = condition.callback,\r\n                            _iO, _keysO, _lenO;\r\n\r\n                        if (_key === '_$') {\r\n                            _keysO = Object.keys(node);\r\n                            _lenO = _keysO.length;\r\n                            for (_iO = 0; _iO < _lenO; _iO++) {\r\n                                if (_fnCheck(_callback, node[_keysO[_iO]])) {\r\n                                    return true;\r\n                                }\r\n                            }\r\n                        } else if (angular.isDefined(node[_key])) {\r\n                            return _fnCheck(_callback, node[_key]);\r\n                        }\r\n                    }\r\n                },\r\n                for_each_filter = function for_each_filter(node, conditions, isAnd) {\r\n                    var i, len = conditions.length, passed = false;\r\n                    if (len === 0) {\r\n                        return null;\r\n                    }\r\n\r\n                    for (i = 0; i < len; i++) {\r\n                        if (_fnProccess(node, conditions[i], !isAnd)) {\r\n                            passed = true;\r\n                            // if condition `or` then return;\r\n                            if (!isAnd) {\r\n                                return true;\r\n                            }\r\n                        } else {\r\n\r\n                            // if condition `and` and result in fnProccess = false then return;\r\n                            if (isAnd) {\r\n                                return false;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    return passed;\r\n                },\r\n\r\n                // Will call _fnAfter to clear data no need\r\n                _fnAfter = function _fnAfter(options, node, isNodePassed, isChildPassed, isParentPassed) {\r\n                    if (isNodePassed === true) {\r\n                        node.__filtered__ = true;\r\n                        node.__filtered_visible__ = true;\r\n                        return; //jmp\r\n                    } else if ((isChildPassed === true && options.showParent === true)\r\n                               || (isParentPassed === true && options.showChild === true)) {\r\n                        node.__filtered__ = false;\r\n                        node.__filtered_visible__ = true;\r\n                        return; //jmp\r\n                    }\r\n\r\n                    // remove attr __filtered__\r\n                    delete(node.__filtered__);\r\n                    delete(node.__filtered_visible__);\r\n                },\r\n                _fnBefore = function _fnBefore(options, node) {\r\n                    if (options.filter.length === 0) {\r\n                        return true;\r\n                    } else {\r\n                        return _fnProccess(node, options.filter, options.beginAnd || false);\r\n                    }\r\n                },\r\n                _fnConvert = function _fnConvert(filters) {\r\n                    // convert filter object to array filter\r\n                    if (angular.isObject(filters) && !angular.isArray(filters)) {\r\n                        _keysF = Object.keys(filters);\r\n                        _lenF = _keysF.length;\r\n                        _filter = [];\r\n\r\n                        if (_lenF > 0) {\r\n                            for (_iF = 0; _iF < _lenF; _iF++) {\r\n\r\n                                if ((typeof filters[_keysF[_iF]]) === 'string' && filters[_keysF[_iF]].length === 0) {\r\n                                    continue;\r\n                                } else if (angular.isArray(filters[_keysF[_iF]])) {\r\n                                    _state = filters[_keysF[_iF]];\r\n                                } else if (angular.isObject(filters[_keysF[_iF]])) {\r\n                                    _state = _fnConvert(filters[_keysF[_iF]]);\r\n                                } else {\r\n                                    _state = {\r\n                                        field:    _keysF[_iF],\r\n                                        callback: filters[_keysF[_iF]]\r\n                                    };\r\n                                }\r\n                                _filter.push(_state);\r\n                            }\r\n                        }\r\n                        _state = null;\r\n                        return _filter;\r\n                    }\r\n                    else {\r\n                        return filters;\r\n                    }\r\n                },\r\n                _fnMain = function _fnMain(treeData, filters, _options) {\r\n                    if (!angular.isArray(treeData)\r\n                        || treeData.length === 0\r\n                        || !(angular.isArray(filters) || angular.isObject(filters))\r\n                        || filters.length === 0) {\r\n                        return treeData;\r\n                    }\r\n\r\n                    var _i, _len,\r\n                        _filter;\r\n\r\n                    _filter = _fnConvert(filters);\r\n                    if (!(angular.isArray(_filter) || angular.isObject(_filter))\r\n                        || _filter.length === 0) {\r\n                        return treeData;\r\n                    }\r\n                    _options.filter = _filter;\r\n                    for (_i = 0, _len = treeData.length; _i < _len; _i++) {\r\n                        for_all_descendants(\r\n                            _options,\r\n                            treeData[_i],\r\n                            '__children__',\r\n                            _fnBefore, _fnAfter\r\n                        );\r\n                    }\r\n\r\n                    return treeData;\r\n                };\r\n\r\n            return _fnMain;\r\n        }]\r\n).factory(\r\n    '$TreeDnDOrderBy', [\r\n        '$filter', function ($filter) {\r\n            var _fnOrderBy = $filter('orderBy'),\r\n                for_all_descendants = function for_all_descendants(options, node, name, fnOrderBy) {\r\n                    var _i, _len, _nodes;\r\n\r\n                    if (angular.isDefined(node[name])) {\r\n                        _nodes = node[name];\r\n                        _len = _nodes.length;\r\n                        // OrderBy children\r\n                        for (_i = 0; _i < _len; _i++) {\r\n                            _nodes[_i] = for_all_descendants(options, _nodes[_i], name, fnOrderBy);\r\n                        }\r\n\r\n                        node[name] = fnOrderBy(node[name], options);\r\n                    }\r\n                    return node;\r\n                },\r\n                _fnOrder = function _fnOrder(list, orderBy) {\r\n                    return _fnOrderBy(list, orderBy);\r\n                },\r\n                _fnMain = function _fnMain(treeData, orderBy) {\r\n                    if (!angular.isArray(treeData)\r\n                        || treeData.length === 0\r\n                        || !(angular.isArray(orderBy) || angular.isObject(orderBy) || angular.isString(orderBy) || angular.isFunction(orderBy))\r\n                        || (orderBy.length === 0 && !angular.isFunction(orderBy))) {\r\n                        return treeData;\r\n                    }\r\n\r\n                    var _i, _len,\r\n                        _iF, _lenF, _keysF;\r\n\r\n                    for (_i = 0, _len = treeData.length; _i < _len; _i++) {\r\n                        treeData[_i] = for_all_descendants(\r\n                            orderBy,\r\n                            treeData[_i],\r\n                            '__children__',\r\n                            _fnOrder\r\n                        );\r\n                    }\r\n\r\n                    treeData = _fnOrder(treeData, orderBy);\r\n                    return treeData;\r\n                };\r\n\r\n            return _fnMain;\r\n        }]\r\n).factory(\r\n    '$TreeDnDConvert', function () {\r\n        var _$initConvert = {\r\n            line2tree: function (data, primaryKey, parentKey) {\r\n                if (!data || data.length === 0 || !primaryKey || !parentKey) {\r\n                    return [];\r\n                }\r\n                var tree = [],\r\n                    rootIds = [],\r\n                    item = data[0],\r\n                    _primary = item[primaryKey],\r\n                    treeObjs = {},\r\n                    parentId, parent,\r\n                    len = data.length,\r\n                    i = 0;\r\n                while (i < len) {\r\n                    item = data[i++];\r\n                    _primary = item[primaryKey];\r\n                    treeObjs[_primary] = item;\r\n                    parentId = item[parentKey];\r\n                    if (parentId) {\r\n                        parent = treeObjs[parentId];\r\n                        if (parent.__children__) {\r\n                            parent.__children__.push(item);\r\n                        } else {\r\n                            parent.__children__ = [item];\r\n                        }\r\n                    } else {\r\n                        rootIds.push(_primary);\r\n                    }\r\n                }\r\n                len = rootIds.length;\r\n                for (i = 0; i < len; i++) {\r\n                    tree.push(treeObjs[rootIds[i]]);\r\n                }\r\n                return tree;\r\n            },\r\n            tree2tree: function (data, parentKey) {\r\n                var access_child = function (data) {\r\n                    var _tree = [];\r\n                    var _i, _len = data.length, _copy, _child;\r\n                    for (_i = 0; _i < _len; _i++) {\r\n                        _copy = angular.copy(data[_i]);\r\n                        if (angular.isArray(_copy[parentKey]) && _copy[parentKey].length > 0) {\r\n                            _child = access_child(_copy[parentKey]);\r\n                            delete(_copy[parentKey]);\r\n                            _copy.__children__ = _child;\r\n                        }\r\n                        _tree.push(_copy);\r\n                    }\r\n                    return _tree;\r\n                };\r\n\r\n                return access_child(data);\r\n            }\r\n        }\r\n\r\n        return _$initConvert;\r\n    }\r\n).factory(\r\n    '$TreeDnDHelper', [\r\n        '$document', '$window', function ($document, $window) {\r\n            var _$helper = {\r\n                nodrag:          function (targetElm) {\r\n                    return (typeof targetElm.attr('data-nodrag')) !== \"undefined\";\r\n                },\r\n                eventObj:        function (e) {\r\n                    var obj = e;\r\n                    if (e.targetTouches !== undefined) {\r\n                        obj = e.targetTouches.item(0);\r\n                    } else if (e.originalEvent !== undefined && e.originalEvent.targetTouches !== undefined) {\r\n                        obj = e.originalEvent.targetTouches.item(0);\r\n                    }\r\n                    return obj;\r\n                },\r\n                dragInfo:        function (scope) {\r\n                    var _node = scope.getData(),\r\n                        _tree = scope.getScopeTree(),\r\n                        _parent = scope.getNode(_node.__parent_real__);\r\n                    return {\r\n                        node:    _node,\r\n                        parent:  _parent,\r\n                        move:    {\r\n                            parent: _parent,\r\n                            pos:    _node.__index__\r\n                        },\r\n                        scope:   scope,\r\n                        target:  _tree,\r\n                        drag:    _tree,\r\n                        drop:    scope.getPrevSibling(_node),\r\n                        changed: false\r\n                    };\r\n                },\r\n                height:          function (element) {\r\n                    return element.prop('scrollHeight');\r\n                },\r\n                width:           function (element) {\r\n                    return element.prop('scrollWidth');\r\n                },\r\n                offset:          function (element) {\r\n                    var boundingClientRect = element[0].getBoundingClientRect();\r\n                    return {\r\n                        width:  element.prop('offsetWidth'),\r\n                        height: element.prop('offsetHeight'),\r\n                        top:    boundingClientRect.top + ($window.pageYOffset || $document[0].body.scrollTop || $document[0].documentElement.scrollTop),\r\n                        left:   boundingClientRect.left + ($window.pageXOffset || $document[0].body.scrollLeft || $document[0].documentElement.scrollLeft)\r\n                    };\r\n                },\r\n                positionStarted: function (e, target) {\r\n                    var pos = {};\r\n                    pos.offsetX = e.pageX - this.offset(target).left;\r\n                    pos.offsetY = e.pageY - this.offset(target).top;\r\n                    pos.startX = pos.lastX = e.pageX;\r\n                    pos.startY = pos.lastY = e.pageY;\r\n                    pos.nowX = pos.nowY = pos.distX = pos.distY = pos.dirAx = 0;\r\n                    pos.dirX = pos.dirY = pos.lastDirX = pos.lastDirY = pos.distAxX = pos.distAxY = 0;\r\n                    return pos;\r\n                },\r\n                positionMoved:   function (e, pos, firstMoving) {\r\n                    // mouse position last events\r\n                    pos.lastX = pos.nowX;\r\n                    pos.lastY = pos.nowY;\r\n                    // mouse position this events\r\n                    pos.nowX = e.pageX;\r\n                    pos.nowY = e.pageY;\r\n                    // distance mouse moved between events\r\n                    pos.distX = pos.nowX - pos.lastX;\r\n                    pos.distY = pos.nowY - pos.lastY;\r\n                    // direction mouse was moving\r\n                    pos.lastDirX = pos.dirX;\r\n                    pos.lastDirY = pos.dirY;\r\n                    // direction mouse is now moving (on both axis)\r\n                    pos.dirX = pos.distX === 0 ? 0 : pos.distX > 0 ? 1 : -1;\r\n                    pos.dirY = pos.distY === 0 ? 0 : pos.distY > 0 ? 1 : -1;\r\n                    // axis mouse is now moving on\r\n                    var newAx = Math.abs(pos.distX) > Math.abs(pos.distY) ? 1 : 0;\r\n                    // do nothing on first move\r\n                    if (firstMoving) {\r\n                        pos.dirAx = newAx;\r\n                        pos.moving = true;\r\n                        return;\r\n                    }\r\n                    // calc distance moved on this axis (and direction)\r\n                    if (pos.dirAx !== newAx) {\r\n                        pos.distAxX = 0;\r\n                        pos.distAxY = 0;\r\n                    } else {\r\n                        pos.distAxX += Math.abs(pos.distX);\r\n                        if (pos.dirX !== 0 && pos.dirX !== pos.lastDirX) {\r\n                            pos.distAxX = 0;\r\n                        }\r\n                        pos.distAxY += Math.abs(pos.distY);\r\n                        if (pos.dirY !== 0 && pos.dirY !== pos.lastDirY) {\r\n                            pos.distAxY = 0;\r\n                        }\r\n                    }\r\n                    pos.dirAx = newAx;\r\n                },\r\n                replaceIndent:   function (scope, element, indent, attr) {\r\n                    attr = attr ? attr : 'left';\r\n                    angular.element(element.children()[0]).css(attr, scope.$callbacks.calsIndent(indent));\r\n                }\r\n            };\r\n            return _$helper;\r\n        }]\r\n).factory(\r\n    '$TreeDnDPlugin',['$injector', function ($injector) {\r\n        var _fnget = function (name) {\r\n                if (angular.isDefined($injector) && $injector.has(name)) {\r\n                    return $injector.get(name);\r\n                }\r\n                return null;\r\n            };\r\n        return _fnget;\r\n    }]\r\n).factory(\r\n    '$TreeDnDTemplate', [\r\n        '$templateCache', function ($templateCache) {\r\n            var templatePath = 'template/TreeDnD/TreeDnD.html',\r\n                copyPath = 'template/TreeDnD/TreeDnDStatusCopy.html',\r\n                movePath = 'template/TreeDnD/TreeDnDStatusMove.html',\r\n                scopes = {},\r\n                temp,\r\n                _$init = {\r\n                    setMove: function (path, scope) {\r\n                        if (!scopes[scope.$id]) {\r\n                            scopes[scope.$id] = {};\r\n                        }\r\n                        scopes[scope.$id].movePath = path;\r\n                    },\r\n                    setCopy: function (path, scope) {\r\n                        if (!scopes[scope.$id]) {\r\n                            scopes[scope.$id] = {};\r\n                        }\r\n                        scopes[scope.$id].copyPath = path;\r\n                    },\r\n                    getPath: function () {\r\n                        return templatePath;\r\n                    },\r\n                    getCopy: function (scope) {\r\n                        if (scopes[scope.$id] && scopes[scope.$id].copyPath) {\r\n                            temp = $templateCache.get(scopes[scope.$id].copyPath);\r\n                            if (temp) {\r\n                                return temp;\r\n                            }\r\n                        }\r\n                        return $templateCache.get(copyPath);\r\n                    },\r\n                    getMove: function (scope) {\r\n                        if (scopes[scope.$id] && scopes[scope.$id].movePath) {\r\n                            temp = $templateCache.get(scopes[scope.$id].movePath);\r\n                            if (temp) {\r\n                                return temp;\r\n                            }\r\n                        }\r\n                        return $templateCache.get(movePath);\r\n                    }\r\n                };\r\n\r\n            return _$init;\r\n        }]\r\n).directive(\r\n    'compile', [\r\n        '$compile', function ($compile) {\r\n            return {\r\n                restrict: 'A',\r\n                link:     function (scope, element, attrs) {\r\n                    scope.$watch(\r\n                        attrs.compile, function (new_val) {\r\n                            if (new_val) {\r\n                                /*\r\n                                 * Compile creates a linking function\r\n                                 * that can be used with any scope.\r\n                                 */\r\n                                var link = $compile(new_val);\r\n                                /*\r\n                                 * Executing the linking function\r\n                                 * creates a new element.\r\n                                 */\r\n                                var new_elem = link(scope);\r\n                                // Which we can then append to our DOM element.\r\n                                if(angular.isFunction(element.empty)){\r\n                                    element.empty()\r\n                                }else{\r\n                                    element.html('');\r\n                                }\r\n\r\n                                element.append(new_elem)\r\n                            }\r\n                        }\r\n                    );\r\n                }\r\n            };\r\n        }]\r\n)\r\n    .directive(\r\n    'compileReplace', [\r\n        '$compile', function ($compile) {\r\n            return {\r\n                restrict: 'A',\r\n                link:     function (scope, element, attrs) {\r\n                    scope.$watch(\r\n                        attrs.compileReplace, function (new_val) {\r\n                            if (new_val) {\r\n                                /*\r\n                                 * Compile creates a linking function\r\n                                 * that can be used with any scope.\r\n                                 */\r\n                                var link = $compile(new_val);\r\n                                /*\r\n                                 * Executing the linking function\r\n                                 * creates a new element.\r\n                                 */\r\n                                var new_elem = link(scope);\r\n\r\n                                element.replaceWith(new_elem)\r\n                            }\r\n                        }\r\n                    );\r\n                }\r\n            };\r\n        }]\r\n).directive(\r\n    'treeDndNodeHandle', function () {\r\n        return {\r\n            restrict: 'A',\r\n            scope:    true,\r\n            link:     function (scope, element, attrs) {\r\n                scope.$element = element;\r\n                scope.$type = 'TreeDnDNodeHandle';\r\n                if (scope.$class.handle) {\r\n                    element.addClass(scope.$class.handle);\r\n                }\r\n            }\r\n        };\r\n    }\r\n).directive(\r\n    'treeDndNode', function () {\r\n        return {\r\n            restrict: 'A',\r\n            replace:  true,\r\n            link:     function (scope, element, attrs) {\r\n                var _enabledDragDrop = (typeof scope.dragEnabled === 'boolean' || typeof scope.dropEnabled === 'boolean');\r\n                scope.$modelValue = null;\r\n                scope.$icon_class = '';\r\n                scope.$node_class = '';\r\n\r\n                if (scope.$class.node) {\r\n                    element.addClass(scope.$class.node);\r\n                    scope.$node_class = scope.$class.node;\r\n                }\r\n\r\n                scope.$watch(\r\n                    attrs.treeDndNode, function (newValue, oldValue, scope) {\r\n                        if (_enabledDragDrop) {\r\n                            scope.setScope(scope, newValue);\r\n                        }\r\n                        scope.$modelValue = newValue;\r\n                        scope.$icon_class = scope.$class.icon[newValue.__icon__];\r\n                    }, true\r\n                );\r\n\r\n                if (_enabledDragDrop) {\r\n\r\n                    scope.$element = element;\r\n                    scope.$type = 'TreeDnDNode';\r\n\r\n                    scope.getScopeNode = function () {\r\n                        return scope;\r\n                    };\r\n\r\n                    scope.getData = function () {\r\n                        return scope.$modelValue;\r\n                    };\r\n\r\n                    scope.getElementChilds = function () {\r\n                        return angular.element(element[0].querySelector('[tree-dnd-nodes]'));\r\n                    };\r\n                }\r\n            }\r\n        };\r\n    }\r\n).directive(\r\n    'treeDndNodes', function () {\r\n        return {\r\n            restrict: 'A',\r\n            replace:  true,\r\n            link:     function (scope, element, attrs) {\r\n                scope.nodes = [];\r\n                scope.$nodes_class = '';\r\n                scope.$type = 'TreeDnDNodes';\r\n                scope.$element = element;\r\n                scope.getScopeNode = null;\r\n\r\n                scope.$watch(\r\n                    attrs.treeDndNodes, function (newValue, oldValue, scope) {\r\n                        scope.nodes = newValue;\r\n                    }, true\r\n                );\r\n\r\n                if (scope.$class.nodes) {\r\n                    element.addClass(scope.$class.nodes);\r\n                    scope.$nodes_class = scope.$class.nodes;\r\n                }\r\n            }\r\n        };\r\n    }\r\n).directive(\r\n    'treeDnd', [\r\n        '$injector', '$timeout', '$http', '$compile', '$window', '$document', '$templateCache',\r\n        '$TreeDnDTemplate', '$TreeDnDClass', '$TreeDnDHelper', '$TreeDnDPlugin',\r\n        function ($injector, $timeout, $http, $compile, $window, $document, $templateCache,\r\n                  $TreeDnDTemplate, $TreeDnDClass, $TreeDnDHelper, $TreeDnDPlugin) {\r\n            return {\r\n                restrict:   'E',\r\n                scope:      true,\r\n                replace:    true,\r\n                controller: [\r\n                    '$scope', '$element', '$attrs', function ($scope, $element, $attrs) {\r\n                        $scope.indent = 20;\r\n                        $scope.indent_plus = 15;\r\n                        $scope.indent_unit = 'px';\r\n                        $scope.$tree_class = 'table';\r\n                        $scope.primary_key = '__uid__';\r\n                        $scope.hasMultiSelect = $attrs.hasMultiSelect === 'true';\r\n                        $scope.onlyDeepestDrop = $attrs.onlyDeepestDrop === 'true';\r\n\r\n                        $scope.$type = 'TreeDnD';\r\n                        // $scope.enabledFilter = null;\r\n                        $scope.colDefinitions = [];\r\n                        $scope.$globals = {};\r\n                        $scope.$class = {};\r\n\r\n                        $scope.treeData = [];\r\n                        $scope.tree_nodes = [];\r\n\r\n                        $scope.sycning = false;\r\n\r\n                        $scope.$class = angular.copy($TreeDnDClass);\r\n                        angular.extend(\r\n                            $scope.$class.icon, {\r\n                                '1':  $attrs.iconExpand || 'glyphicon glyphicon-minus',\r\n                                '0':  $attrs.iconCollapse || 'glyphicon glyphicon-plus',\r\n                                '-1': $attrs.iconLeaf || 'glyphicon glyphicon-file'\r\n                            }\r\n                        );\r\n\r\n                        $scope.for_all_descendants = function (node, fn) {\r\n                            if (angular.isFunction(fn)) {\r\n                                var _i, _len, _nodes;\r\n\r\n                                if (fn(node)) {\r\n                                    return false;\r\n                                }\r\n                                _nodes = node.__children__;\r\n                                _len = _nodes.length;\r\n                                for (_i = 0; _i < _len; _i++) {\r\n                                    if (!$scope.for_all_descendants(_nodes[_i], fn)) {\r\n                                        return false;\r\n                                    }\r\n                                }\r\n                            }\r\n                            return true;\r\n                        };\r\n\r\n                        $scope.getLastDescendant = function (node) {\r\n                            var last_child, n;\r\n                            if (!node) {\r\n                                node = $scope.tree ? $scope.tree.selected_node : false;\r\n                            }\r\n                            if(node === false){\r\n                                return false;\r\n                            }\r\n                            n = node.__children__.length;\r\n                            if (n === 0) {\r\n                                return node;\r\n                            } else {\r\n                                last_child = node.__children__[n - 1];\r\n                                return $scope.getLastDescendant(last_child);\r\n                            }\r\n                        };\r\n\r\n                        $scope.getElementChilds = function () {\r\n                            return angular.element($element[0].querySelector('[tree-dnd-nodes]'));\r\n                        };\r\n\r\n                        $scope.onClick = function (node) {\r\n                            if (angular.isDefined($scope.tree) && angular.isFunction($scope.tree.on_click)) {\r\n                                // We want to detach from Angular's digest cycle so we can\r\n                                // independently measure the time for one cycle.\r\n                                setTimeout(\r\n                                    function () {\r\n                                        $scope.tree.on_click(node);\r\n                                    }, 0\r\n                                );\r\n                            }\r\n                        };\r\n\r\n                        $scope.onSelect = function (node) {\r\n                            if (angular.isDefined($scope.tree)) {\r\n                                if (node !== $scope.tree.selected_node) {\r\n                                    $scope.tree.select_node(node);\r\n                                }\r\n\r\n                                if (angular.isFunction($scope.tree.on_select)) {\r\n                                    setTimeout(\r\n                                        function () {\r\n                                            $scope.tree.on_select(node);\r\n                                        }, 0\r\n                                    );\r\n                                }\r\n                            }\r\n                        };\r\n\r\n                        var passedExpand, _clone;\r\n                        $scope.toggleExpand = function (node, fnCallback) {\r\n                            passedExpand = true;\r\n                            if (angular.isFunction(fnCallback) && !fnCallback(node)) {\r\n                                passedExpand = false;\r\n                            } else if (angular.isFunction($scope.$callbacks.expand) && !$scope.$callbacks.expand(node)) {\r\n                                passedExpand = false;\r\n                            }\r\n\r\n                            if (passedExpand) {\r\n                                if (node.__children__.length > 0) {\r\n                                    node.__expanded__ = !node.__expanded__;\r\n                                }\r\n                            }\r\n                        };\r\n\r\n                        $scope.getHash = function (node) {\r\n                            if ($scope.primary_key === '__uid__') {\r\n                                return '#' + node.__parent__ + '#' + node.__uid__;\r\n                            } else {\r\n                                return '#' + node.__parent__ + '#' + node[$scope.primary_key];\r\n                            }\r\n                        };\r\n\r\n                        $scope.$callbacks = {\r\n                            for_all_descendants: $scope.for_all_descendants,\r\n                            expand:              function (node) {\r\n                                return true;\r\n                            },\r\n                            accept:              function (dragInfo, moveTo, isChanged) {\r\n                                return $scope.dropEnabled === true;\r\n                            },\r\n                            calsIndent:          function (level, skipUnit, skipEdge) {\r\n                                var unit = 0,\r\n                                    edge = skipEdge ? 0 : $scope.indent_plus;\r\n                                if (!skipUnit) {\r\n                                    unit = $scope.indent_unit ? $scope.indent_unit : 'px';\r\n                                }\r\n\r\n                                if (level - 1 < 1) {\r\n                                    return edge + unit;\r\n                                } else {\r\n                                    return $scope.indent * (level - 1) + edge + unit;\r\n                                }\r\n                            },\r\n                            droppable:           function () {\r\n                                return $scope.dropEnabled === true;\r\n                            },\r\n                            draggable:           function () {\r\n                                return $scope.dragEnabled === true;\r\n                            },\r\n                            beforeDrop:          function (event) {\r\n                                return true;\r\n                            },\r\n                            changeKey:           function (node) {\r\n                                var _key = node.__uid__;\r\n                                node.__uid__ = Math.random();\r\n                                if (node.__selected__) {\r\n                                    delete(node.__selected__);\r\n                                }\r\n\r\n                                if ($scope.primary_key !== '__uid__') {\r\n                                    _key = '' + node[$scope.primary_key];\r\n                                    _key = _key.replace(/_#.+$/g, '') + '_#' + node.__uid__;\r\n\r\n                                    node[$scope.primary_key] = _key;\r\n                                }\r\n                                // delete(node.__hashKey__);\r\n                            },\r\n                            clone:               function (node, _this) {\r\n                                _clone = angular.copy(node);\r\n                                this.for_all_descendants(_clone, this.changeKey);\r\n                                return _clone;\r\n                            },\r\n                            remove:              function (node, parent, _this) {\r\n                                return parent.splice(node.__index__, 1)[0];\r\n                            },\r\n                            add:                 function (node, pos, parent, _this) {\r\n                                if (parent) {\r\n                                    if (parent.length > -1) {\r\n                                        if (pos > -1) {\r\n                                            parent.splice(pos, 0, node);\r\n                                        } else {\r\n                                            // todo If children need load crazy\r\n                                            parent.push(node);\r\n                                        }\r\n                                    } else {\r\n                                        parent.push(node);\r\n                                    }\r\n                                }\r\n                            }\r\n                        };\r\n\r\n                        if ($attrs.enableDrag || $attrs.enableDrop) {\r\n                            $scope.placeElm = null;\r\n                            //                            $scope.dragBorder = 30;\r\n                            $scope.dragEnabled = null;\r\n                            $scope.dropEnabled = null;\r\n                            $scope.horizontal = null;\r\n\r\n                            if ($attrs.enableDrag) {\r\n\r\n                                $scope.dragDelay = 0;\r\n                                $scope.enabledMove = true;\r\n                                $scope.statusMove = true;\r\n                                $scope.enabledHotkey = false;\r\n                                $scope.enabledCollapse = null;\r\n                                $scope.statusElm = null;\r\n                                $scope.dragging = null;\r\n\r\n                                angular.extend(\r\n                                    $scope.$callbacks, {\r\n                                        beforeDrag: function (scopeDrag) {\r\n                                            return true;\r\n                                        },\r\n                                        dragStop:   function (event, skiped) {},\r\n                                        dropped:    function (info, pass, isMove) {\r\n                                            if (!info) {\r\n                                                return null;\r\n                                            }\r\n\r\n                                            if (!info.changed && isMove) {\r\n                                                return false;\r\n                                            }\r\n                                            var _node = info.node,\r\n                                                _nodeAdd = null,\r\n                                                _move = info.move,\r\n                                                _parent = null,\r\n                                                _parentRemove = (info.parent || info.drag.treeData),\r\n                                                _parentAdd = (_move.parent || info.target.treeData);\r\n\r\n                                            if (info.target.$callbacks.accept(info, info.move, info.changed)) {\r\n                                                if (isMove) {\r\n                                                    _parent = _parentRemove;\r\n                                                    if (angular.isDefined(_parent.__children__)) {\r\n                                                        _parent = _parent.__children__;\r\n                                                    }\r\n\r\n                                                    _nodeAdd = info.drag.$callbacks.remove(\r\n                                                        _node,\r\n                                                        _parent,\r\n                                                        info.drag.$callbacks\r\n                                                    );\r\n                                                } else {\r\n                                                    _nodeAdd = info.drag.$callbacks.clone(_node, info.drag.$callbacks);\r\n                                                }\r\n\r\n                                                // if node dragging change index in sample node parent\r\n                                                // and index node decrement\r\n                                                if (isMove &&\r\n                                                    info.drag === info.target &&\r\n                                                    _parentRemove === _parentAdd &&\r\n                                                    _move.pos >= info.node.__index__) {\r\n                                                    _move.pos--;\r\n                                                }\r\n\r\n                                                _parent = _parentAdd;\r\n                                                if (_parent.__children__) {\r\n                                                    _parent = _parent.__children__;\r\n                                                }\r\n\r\n                                                info.target.$callbacks.add(\r\n                                                    _nodeAdd,\r\n                                                    _move.pos,\r\n                                                    _parent,\r\n                                                    info.drag.$callbacks\r\n                                                );\r\n\r\n                                                return true;\r\n                                            }\r\n\r\n                                            return false;\r\n                                        },\r\n                                        dragStart:  function (event) {},\r\n                                        dragMove:   function (event) {}\r\n                                    }\r\n                                );\r\n\r\n                                $scope.setDragging = function (dragInfo) {\r\n                                    $scope.dragging = dragInfo;\r\n                                };\r\n\r\n                                $scope.enableMove = function (val) {\r\n                                    if (typeof val === \"boolean\") {\r\n                                        $scope.enabledMove = val;\r\n                                    } else {\r\n                                        $scope.enabledMove = true;\r\n                                    }\r\n                                };\r\n\r\n                                if ($attrs.enableStatus) {\r\n                                    $scope.enabledStatus = false;\r\n\r\n                                    $scope.hideStatus = function () {\r\n                                        if ($scope.statusElm) {\r\n                                            $scope.statusElm.addClass($scope.$class.hidden);\r\n                                        }\r\n                                    };\r\n\r\n                                    $scope.refreshStatus = function () {\r\n                                        if (!$scope.dragging) {\r\n                                            return;\r\n                                        }\r\n\r\n                                        if ($scope.enabledStatus) {\r\n                                            var statusElmOld = $scope.statusElm;\r\n                                            if ($scope.enabledMove) {\r\n                                                $scope.statusElm = angular.element($TreeDnDTemplate.getMove($scope));\r\n                                            } else {\r\n                                                $scope.statusElm = angular.element($TreeDnDTemplate.getCopy($scope));\r\n                                            }\r\n\r\n                                            if (statusElmOld !== $scope.statusElm) {\r\n                                                if (statusElmOld) {\r\n                                                    $scope.statusElm.attr('class', statusElmOld.attr('class'));\r\n                                                    $scope.statusElm.attr('style', statusElmOld.attr('style'));\r\n                                                    statusElmOld.remove();\r\n                                                }\r\n                                                $document.find('body').append($scope.statusElm);\r\n\r\n                                            }\r\n\r\n                                            $scope.statusElm.removeClass($scope.$class.hidden);\r\n                                        }\r\n                                    };\r\n\r\n                                    $scope.setPositionStatus = function (e) {\r\n                                        if ($scope.statusElm) {\r\n                                            $scope.statusElm.css(\r\n                                                {\r\n                                                    'left':    e.pageX + 10 + 'px',\r\n                                                    'top':     e.pageY + 15 + 'px',\r\n                                                    'z-index': 9999\r\n                                                }\r\n                                            );\r\n                                            $scope.statusElm.addClass($scope.$class.status);\r\n                                        }\r\n                                    };\r\n                                }\r\n                            }\r\n\r\n                            $scope.targeting = false;\r\n\r\n                            $scope.getPrevSibling = function (node) {\r\n                                if (node && node.__index__ > 0) {\r\n                                    var _parent, _index = node.__index__ - 1;\r\n\r\n                                    if (angular.isDefined(node.__parent_real__)) {\r\n                                        _parent = $scope.tree_nodes[node.__parent_real__];\r\n                                        return _parent.__children__[_index];\r\n                                    }\r\n                                    return $scope.treeData[_index];\r\n\r\n                                }\r\n                                return null;\r\n                            };\r\n\r\n                            $scope.getNode = function (index) {\r\n                                if (angular.isUndefinedOrNull(index)) {\r\n                                    return null;\r\n                                }\r\n                                return $scope.tree_nodes[index];\r\n                            };\r\n\r\n                            $scope.setScope = function (scope, node) {\r\n                                var _hash = $scope.getHash(node);\r\n                                if ($scope.$globals[_hash] !== scope) {\r\n                                    $scope.$globals[_hash] = scope;\r\n                                }\r\n                            };\r\n\r\n                            $scope.getScope = function (node) {\r\n                                if (node) {\r\n                                    return $scope.$globals[$scope.getHash(node)];\r\n                                }\r\n                                return $scope;\r\n\r\n                            };\r\n\r\n                            $scope.initPlace = function (element, dragElm) {\r\n\r\n                                var tagName = null,\r\n                                    isTable = false;\r\n\r\n                                if (element) {\r\n                                    tagName = element.prop('tagName').toLowerCase();\r\n                                    isTable = (tagName === 'tr' || tagName === 'td');\r\n                                } else {\r\n                                    tagName = $scope.getElementChilds().prop('tagName').toLowerCase();\r\n                                    isTable = (tagName === 'tbody' || tagName === 'table');\r\n                                }\r\n\r\n                                if (!$scope.placeElm) {\r\n\r\n                                    if (isTable) {\r\n                                        $scope.placeElm = angular.element($window.document.createElement('tr'));\r\n                                        var _len_down = $scope.colDefinitions.length;\r\n                                        $scope.placeElm.append(\r\n                                            angular.element($window.document.createElement('td'))\r\n                                                .addClass($scope.$class.empty)\r\n                                                .addClass('indented')\r\n                                                .addClass($scope.$class.place)\r\n                                        );\r\n                                        while (_len_down-- > 0) {\r\n                                            $scope.placeElm.append(\r\n                                                angular.element($window.document.createElement('td'))\r\n                                                    .addClass($scope.$class.empty)\r\n                                                    .addClass($scope.$class.place)\r\n                                            );\r\n                                        }\r\n                                    } else {\r\n                                        $scope.placeElm = angular.element($window.document.createElement('li'))\r\n                                            .addClass($scope.$class.empty)\r\n                                            .addClass($scope.$class.place);\r\n                                    }\r\n\r\n                                }\r\n\r\n                                if (dragElm) {\r\n                                    $scope.placeElm.css('height', $TreeDnDHelper.height(dragElm) + 'px');\r\n                                }\r\n\r\n                                if (element) {\r\n                                    element[0].parentNode.insertBefore($scope.placeElm[0], element[0]);\r\n                                } else {\r\n                                    $scope.getElementChilds().append($scope.placeElm);\r\n                                }\r\n\r\n                                return $scope.placeElm;\r\n                            };\r\n\r\n                            $scope.hidePlace = function () {\r\n                                if ($scope.placeElm) {\r\n                                    $scope.placeElm.addClass($scope.$class.hidden);\r\n                                }\r\n                            };\r\n\r\n                            $scope.showPlace = function () {\r\n                                if ($scope.placeElm) {\r\n                                    $scope.placeElm.removeClass($scope.$class.hidden);\r\n                                }\r\n                            };\r\n\r\n                            $scope.getScopeTree = function () {\r\n                                return $scope;\r\n                            };\r\n\r\n                        }\r\n\r\n                        $scope.$safeApply = function (fn) {\r\n                            var phase = this.$root.$$phase;\r\n                            if (phase === '$apply' || phase === '$digest') {\r\n                                if (fn && (typeof(fn) === 'function')) {\r\n                                    fn();\r\n                                }\r\n                            } else {\r\n                                this.$apply(fn);\r\n                            }\r\n                        };\r\n\r\n                    }],\r\n                compile:    function compile(tElement, tAttrs) {\r\n\r\n                    var $_Template = '',\r\n                        _element = tElement.html().trim();\r\n                    if (_element.length > 0) {\r\n                        $_Template = _element;\r\n                        tElement.html('');\r\n                    }\r\n\r\n                    return function fnPost(scope, element, attrs) {\r\n                        var getExpandOn = function () {\r\n                                if (scope.treeData && scope.treeData.length) {\r\n                                    var _firstNode = scope.treeData[0], _keys = Object.keys(_firstNode),\r\n                                        _regex = new RegExp(\"^__([a-zA-Z0-9_\\-]*)__$\"),\r\n                                        _len,\r\n                                        i;\r\n                                    // Auto get first field with type is string;\r\n                                    for (i = 0, _len = _keys.length; i < _len; i++) {\r\n                                        if (typeof (_firstNode[_keys[i]]) === 'string' && !_regex.test(_keys[i])) {\r\n                                            scope.expandingProperty = _keys[i];\r\n                                            return;\r\n                                        }\r\n                                    }\r\n\r\n                                    // Auto get first\r\n                                    if (angular.isUndefinedOrNull(scope.expandingProperty)) {\r\n                                        scope.expandingProperty = _keys[0];\r\n                                    }\r\n\r\n                                }\r\n                            },\r\n                            getColDefs = function () {\r\n                                // Auto get Defs except attribute __level__ ....\r\n                                if (scope.treeData.length) {\r\n                                    var _col_defs = [], _firstNode = scope.treeData[0],\r\n                                        _regex = new RegExp(\"(^__([a-zA-Z0-9_\\-]*)__$|^\" + scope.expandingProperty + \"$)\"),\r\n                                        _keys = Object.keys(_firstNode),\r\n                                        i, _len;\r\n                                    // Auto get first field with type is string;\r\n                                    for (i = 0, _len = _keys.length; i < _len; i++) {\r\n                                        if (typeof (_firstNode[_keys[i]]) === 'string' && !_regex.test(_keys[i])) {\r\n                                            _col_defs.push(\r\n                                                {\r\n                                                    field: _keys[i]\r\n                                                }\r\n                                            );\r\n                                        }\r\n                                    }\r\n                                    scope.colDefinitions = _col_defs;\r\n                                }\r\n                            },\r\n                            _fnInitFilter,\r\n                            _fnInitOrderBy,\r\n                            _fnGetControl,\r\n                            _fnInitDrag,\r\n                            do_f = function (root, node, parent, parent_real, level, visible, index) {\r\n                                var _i, _len, _icon, _index_real, _dept, _hashKey;\r\n                                if (!angular.isArray(node.__children__)) {\r\n                                    node.__children__ = [];\r\n                                }\r\n\r\n                                node.__parent_real__ = parent_real;\r\n                                node.__parent__ = parent;\r\n                                _len = node.__children__.length;\r\n\r\n                                if (angular.isUndefinedOrNull(node.__expanded__) && _len > 0) {\r\n                                    node.__expanded__ = level < scope.expandLevel;\r\n                                }\r\n\r\n                                if (_len === 0) {\r\n                                    _icon = -1;\r\n                                } else {\r\n                                    if (node.__expanded__) {\r\n                                        _icon = 1;\r\n                                    } else {\r\n                                        _icon = 0;\r\n                                    }\r\n                                }\r\n                                // Insert item vertically\r\n                                _index_real = root.length;\r\n                                node.__index__ = index;\r\n                                node.__index_real__ = _index_real;\r\n                                node.__level__ = level;\r\n                                node.__icon__ = _icon;\r\n                                node.__visible__ = !!visible;\r\n\r\n                                if (angular.isUndefinedOrNull(node.__uid__)) {\r\n                                    node.__uid__ = \"\" + Math.random();\r\n                                }\r\n\r\n                                root.push(node);\r\n\r\n                                // Check node children\r\n                                _dept = 1;\r\n                                if (_len > 0) {\r\n                                    for (_i = 0; _i < _len; _i++) {\r\n                                        _dept += do_f(\r\n                                            root,\r\n                                            node.__children__[_i],\r\n                                            (scope.primary_key === '__uid__') ? node.__uid__ : node[scope.primary_key],\r\n                                            _index_real,\r\n                                            level + 1,\r\n                                            visible && node.__expanded__,\r\n                                            _i\r\n                                        );\r\n                                    }\r\n                                }\r\n\r\n                                _hashKey = scope.getHash(node);\r\n\r\n                                if (angular.isUndefinedOrNull(node.__hashKey__) || node.__hashKey__ !== _hashKey) {\r\n                                    node.__hashKey__ = _hashKey;\r\n                                    // delete(scope.$globals[_hashKey]);\r\n                                }\r\n\r\n                                node.__dept__ = _dept;\r\n\r\n                                return _dept;\r\n                            },\r\n                            reload_data = function (oData) {\r\n                                var _data,\r\n                                    _len,\r\n                                    _tree_nodes = [];\r\n//                                console.log('---------');\r\n                                if (angular.isDefined(oData)) {\r\n                                    if (!angular.isArray(oData) || oData.length === 0) {\r\n                                        return [];\r\n                                    } else {\r\n                                        _data = oData;\r\n                                    }\r\n                                } else if (!angular.isArray(scope.treeData) || scope.treeData.length === 0) {\r\n                                    return [];\r\n                                } else {\r\n                                    _data = scope.treeData;\r\n                                }\r\n\r\n                                if (!attrs.expandOn) {\r\n                                    getExpandOn();\r\n                                }\r\n\r\n                                if (!attrs.columnDefs) {\r\n                                    getColDefs();\r\n                                }\r\n\r\n                                if (angular.isDefined(scope.orderBy)) {\r\n                                    if (!angular.isFunction(_fnInitOrderBy)) {\r\n                                        _fnInitOrderBy = $TreeDnDPlugin('$TreeDnDOrderBy');\r\n                                    }\r\n\r\n                                    if (angular.isFunction(_fnInitOrderBy)) {\r\n                                        _data = _fnInitOrderBy(_data, scope.orderBy);\r\n                                    }\r\n                                }\r\n\r\n                                if (angular.isDefined(scope.filter)) {\r\n                                    if (!angular.isFunction(_fnInitFilter)) {\r\n                                        _fnInitFilter = $TreeDnDPlugin('$TreeDnDFilter');\r\n                                    }\r\n\r\n                                    if (angular.isFunction(_fnInitFilter)) {\r\n                                        _data = _fnInitFilter(_data, scope.filter, scope.filterOptions);\r\n                                    }\r\n                                }\r\n\r\n                                _len = _data.length;\r\n                                if (_len > 0) {\r\n                                    var _i,\r\n                                        _offset, _max, _min, _keys,\r\n                                        _deptTotal = 0;\r\n\r\n                                    for (_i = 0; _i < _len; _i++) {\r\n                                        _deptTotal += do_f(_tree_nodes, _data[_i], null, null, 1, true, _i);\r\n                                    }\r\n\r\n                                    // clear Element Empty\r\n                                    _keys = Object.keys(scope.$globals);\r\n                                    _len = scope.$globals.length;\r\n                                    _offset = _len - _deptTotal;\r\n\r\n                                    if (_offset !== 0) {\r\n                                        _max = _len - _offset;\r\n                                        _min = _max - Math.abs(_offset);\r\n                                        for (_i = _min; _i < _max; _i++) {\r\n                                            delete(scope.$globals[_keys[_i]]);\r\n                                        }\r\n                                    }\r\n                                }\r\n\r\n                                // clear memory\r\n                                if (angular.isDefined(scope.tree_nodes)) {\r\n                                    delete(scope.tree_nodes);\r\n                                }\r\n\r\n                                scope.tree_nodes = _tree_nodes;\r\n                                return _tree_nodes;\r\n                            },\r\n                            _defaultFilterOption = {\r\n                                showParent: true,\r\n                                showChild:  false,\r\n                                beginAnd:   true\r\n                            },\r\n                            tree,\r\n                            check_exist_attr = function (attrs, existAttr, isAnd) {\r\n                                if (angular.isUndefinedOrNull(existAttr)) {\r\n                                    return false;\r\n                                }\r\n\r\n                                if (existAttr === '*' || !angular.isUndefined(attrs[existAttr])) {\r\n                                    return true;\r\n                                }\r\n\r\n                                if (angular.isArray(existAttr)) {\r\n                                    return for_each_attrs(attrs, existAttr, isAnd);\r\n                                }\r\n                            },\r\n                            for_each_attrs = function (attrs, exist, isAnd) {\r\n                                var i, len = exist.length, passed = false;\r\n\r\n                                if (len === 0) {\r\n                                    return null;\r\n                                }\r\n                                for (i = 0; i < len; i++) {\r\n                                    if (check_exist_attr(attrs, exist[i], !isAnd)) {\r\n                                        passed = true;\r\n                                        if (!isAnd) {\r\n                                            return true;\r\n                                        }\r\n                                    } else {\r\n                                        if (isAnd) {\r\n                                            return false;\r\n                                        }\r\n                                    }\r\n                                }\r\n\r\n                                return passed;\r\n                            },\r\n                            generateWatch = function (type, nameAttr, valDefault, nameScope, fnNotExist, fnAfter, fnBefore) {\r\n                                nameScope = nameScope || nameAttr;\r\n                                if (typeof type === 'string' || angular.isArray(type)) {\r\n                                    if (angular.isFunction(fnBefore) && fnBefore()) {\r\n                                        return;//jmp\r\n                                    }\r\n                                    if (typeof tAttrs[nameAttr] === 'string') {\r\n                                        scope.$watch(\r\n                                            tAttrs[nameAttr], function (val, old, scope) {\r\n                                                if ((typeof type === 'string' && typeof val === type) ||\r\n                                                    (angular.isArray(type) && type.indexOf(typeof val) > -1)\r\n                                                ) {\r\n                                                    scope[nameScope] = val;\r\n                                                } else {\r\n                                                    if (angular.isFunction(valDefault)) {\r\n                                                        scope[nameScope] = valDefault(val);\r\n                                                    } else {\r\n                                                        scope[nameScope] = valDefault;\r\n                                                    }\r\n                                                }\r\n\r\n                                                if (angular.isFunction(fnAfter)) {\r\n                                                    fnAfter(scope[nameScope], scope);\r\n                                                }\r\n                                            }, true\r\n                                        );\r\n                                    } else {\r\n\r\n                                        if (angular.isFunction(fnNotExist)) {\r\n                                            scope[nameScope] = fnNotExist();\r\n                                        } else if (!angular.isUndefined(fnNotExist)) {\r\n                                            scope[nameScope] = fnNotExist;\r\n                                        }\r\n                                    }\r\n                                }\r\n                            },\r\n                            _watches = [\r\n                                [\r\n                                    'enableDrag', [\r\n                                    ['boolean', 'enableStatus', null, 'enabledStatus'],\r\n                                    ['boolean', 'enableMove', null, 'enabledMove'],\r\n                                    ['number', 'dragDelay', 0, null, 0],\r\n                                    ['boolean', 'enableCollapse', null, 'enabledCollapse'],\r\n                                    [\r\n                                        'boolean', 'enableHotkey', null, 'enabledHotkey', null, function (isHotkey) {\r\n                                        if (isHotkey) {\r\n                                            scope.enabledMove = false;\r\n                                        } else {\r\n                                            scope.enabledMove = scope.statusMove;\r\n                                        }\r\n                                    }]\r\n                                ]],\r\n                                [\r\n                                    ['enableDrag', 'enableStatus'], [\r\n                                    [\r\n                                        'string', 'templateCopy', attrs.templateCopy, 'templateCopy', null,\r\n                                        function (_url) {\r\n                                            if (_url && $templateCache.get(_url)) {\r\n                                                $TreeDnDTemplate.setCopy(_url, scope);\r\n                                            }\r\n                                        }],\r\n                                    [\r\n                                        'string', 'templateMove', attrs.templateMove, 'templateMove', null,\r\n                                        function (_url) {\r\n                                            if (_url && $templateCache.get(_url)) {\r\n                                                $TreeDnDTemplate.setMove(_url, scope);\r\n                                            }\r\n                                        }]\r\n                                ]],\r\n                                [\r\n                                    [['enableDrag', 'enableDrop']], [\r\n                                    ['number', 'dragBorder', 30, 'dragBorder', 30]]\r\n                                ],\r\n                                [\r\n                                    '*', [\r\n                                    ['boolean', 'horizontal'],\r\n                                    [\r\n                                        'callback', 'treeClass', function (val) {\r\n                                        switch (typeof val) {\r\n                                            case 'string':\r\n                                                scope.$tree_class = val;\r\n                                                break;\r\n                                            case 'object':\r\n                                                angular.extend(scope.$class, val);\r\n                                                scope.$tree_class = scope.$class.tree;\r\n                                                break;\r\n                                            default:\r\n                                                scope.$tree_class = attrs.treeClass;\r\n                                                break;\r\n                                        }\r\n                                    }, 'treeClass', function () {\r\n                                        scope.$tree_class = scope.$class.tree + ' table';\r\n                                    }, null, function () {\r\n                                        if (/^(\\s+[\\w\\-]+){2,}$/g.test(\" \" + attrs.treeClass)) {\r\n                                            scope.$tree_class = attrs.treeClass.trim();\r\n                                            return true;\r\n                                        }\r\n                                    }],\r\n                                    [\r\n                                        ['object', 'string'], 'expandOn', getExpandOn, 'expandingProperty', getExpandOn,\r\n                                        function (expandOn) {\r\n                                            if (angular.isUndefinedOrNull(expandOn)) {\r\n                                                scope.expandingProperty = attrs.expandOn;\r\n                                            }\r\n                                        }],\r\n                                    [\r\n                                        'object', 'treeControl', angular.isDefined(scope.tree) ? scope.tree : {},\r\n                                        'tree', null, function ($tree) {\r\n\r\n                                        if (!angular.isFunction(_fnGetControl)) {\r\n                                            _fnGetControl = $TreeDnDPlugin('$TreeDnDControl');\r\n                                        }\r\n\r\n                                        if (angular.isFunction(_fnGetControl)) {\r\n                                            tree = angular.extend(\r\n                                                $tree,\r\n                                                _fnGetControl(scope)\r\n                                            );\r\n                                        }\r\n                                    }],\r\n                                    [\r\n                                        ['array', 'object'], 'columnDefs', getColDefs, 'colDefinitions', getColDefs,\r\n                                        function (colDefs) {\r\n                                            if (angular.isUndefinedOrNull(colDefs) || !angular.isArray(colDefs)) {\r\n                                                scope.colDefinitions = getColDefs();\r\n                                            }\r\n                                        }],\r\n                                    [['object', 'string', 'array', 'function'], 'orderBy', attrs.orderBy],\r\n                                    [\r\n                                        ['object', 'array'], 'filter', null, 'filter', null, function (filters) {\r\n                                        var _passed = false;\r\n                                        if (angular.isDefined(filters) && !angular.isArray(filters)) {\r\n                                            var _keysF = Object.keys(filters),\r\n                                                _lenF = _keysF.length, _iF;\r\n\r\n                                            if (_lenF > 0) {\r\n                                                for (_iF = 0; _iF < _lenF; _iF++) {\r\n\r\n                                                    if ((typeof filters[_keysF[_iF]]) === 'string' &&\r\n                                                        filters[_keysF[_iF]].length === 0) {\r\n                                                        continue;\r\n                                                    }\r\n                                                    _passed = true;\r\n                                                    break;\r\n                                                }\r\n                                            }\r\n                                        }\r\n\r\n                                        scope.enabledFilter = _passed;\r\n                                        reload_data();\r\n                                    }],\r\n                                    [\r\n                                        'object', 'filterOptions', _defaultFilterOption, 'filterOptions',\r\n                                        _defaultFilterOption, function (option) {\r\n                                        if (typeof option === \"object\") {\r\n                                            scope.filterOptions = angular.extend(_defaultFilterOption, option);\r\n                                        }\r\n                                    }],\r\n                                    ['string', 'primaryKey', attrs.primaryKey, 'primary_key', '__uid__'],\r\n                                    ['string', 'indentUnit', attrs.indentUnit, 'indent_unit'],\r\n                                    ['number', 'indent', 30, null, 30],\r\n                                    ['number', 'indentPlus', 20, null, 20],\r\n                                    [\r\n                                        'null', 'callbacks',\r\n                                        function (optCallbacks) {\r\n                                            angular.forEach(\r\n                                                optCallbacks, function (value, key) {\r\n                                                    if (typeof value === \"function\") {\r\n                                                        if (scope.$callbacks[key]) {\r\n                                                            scope.$callbacks[key] = value;\r\n                                                        }\r\n                                                    }\r\n                                                }\r\n                                            );\r\n                                            return scope.$callbacks;\r\n                                        },\r\n                                        '$callbacks'\r\n                                    ],\r\n                                    [\r\n                                        'number', 'expandLevel', 3, 'expandLevel', 3, function () {\r\n                                        reload_data();\r\n                                    }],\r\n                                    ['boolean', 'enableDrag', null, 'dragEnabled'],\r\n                                    ['boolean', 'enableDrop', null, 'dropEnabled']\r\n                                ]]\r\n                            ],\r\n                            w, lenW = _watches.length,\r\n                            i, len,\r\n                            _curW,\r\n                            _typeW, _nameW, _defaultW, _scopeW, _NotW, _AfterW, _BeforeW;\r\n                        for (w = 0; w < lenW; w++) {\r\n                            // skip if not exist\r\n                            if (!check_exist_attr(attrs, _watches[w][0], true)) {\r\n                                continue;\r\n                            }\r\n                            _curW = _watches[w][1];\r\n                            for (i = 0, len = _curW.length; i < len; i++) {\r\n                                _typeW = _curW[i][0];\r\n                                _nameW = _curW[i][1];\r\n                                _defaultW = _curW[i][2];\r\n                                _scopeW = _curW[i][3];\r\n                                _NotW = _curW[i][4];\r\n                                _AfterW = _curW[i][5];\r\n                                _BeforeW = _curW[i][6];\r\n                                generateWatch(_typeW, _nameW, _defaultW, _scopeW, _NotW, _AfterW, _BeforeW);\r\n                            }\r\n                        }\r\n\r\n                        if (attrs.treeData) {\r\n                            scope.$watch(\r\n                                attrs.treeData, function (val) {\r\n                                    scope.treeData = val;\r\n                                }, true\r\n                            );\r\n                        }\r\n\r\n                        scope.$watch(\r\n                            'treeData', function (val) {\r\n                                reload_data(val);\r\n                            }, true\r\n                        );\r\n\r\n                        scope.reload_data = reload_data;\r\n\r\n                        if (attrs.enableDrag) {\r\n                            _fnInitDrag = $TreeDnDPlugin('$TreeDnDDrag');\r\n                            if (angular.isFunction(_fnInitDrag)) {\r\n                                _fnInitDrag(scope, element, $window, $document);\r\n                            }\r\n                        }\r\n\r\n                        // apply Template\r\n                        scope.$safeApply(\r\n                            function () {\r\n                                if ($_Template.length > 0) {\r\n                                    element.append($compile($_Template)(scope));\r\n                                } else {\r\n                                    $http.get(\r\n                                        attrs.templateUrl || $TreeDnDTemplate.getPath(),\r\n                                        {cache: $templateCache}\r\n                                    ).success(\r\n                                        function (data) {\r\n                                            element.append($compile(data.trim())(scope));\r\n                                        }\r\n                                    );\r\n                                }\r\n                            }\r\n                        );\r\n                    };\r\n                }\r\n            };\r\n        }]\r\n).factory(\r\n    '$TreeDnDDrag', [\r\n        '$rootScope', '$timeout', '$TreeDnDHelper',\r\n        function ($rootScope, $timeout, $TreeDnDHelper) {\r\n            var _fnDragEnd;\r\n            var holderWasShown = false;\r\n            var nodesSelected = [];\r\n            var lastSelectedNode = null;\r\n\r\n            $rootScope.resetNodesSelected = function () {\r\n                nodesSelected.forEach(function (node) { node.__selected = false; });\r\n                nodesSelected = [];\r\n                lastSelectedNode = null;\r\n            };\r\n\r\n            var _offset,\r\n                _fnPlaceHolder = function (e, $params) {\r\n                    if ($params.placeElm) {\r\n                        _offset = $TreeDnDHelper.offset($params.placeElm);\r\n                        if (_offset.top <= e.pageY && e.pageY <= _offset.top + _offset.height &&\r\n                            _offset.left <= e.pageX && e.pageX <= _offset.left + _offset.width\r\n                           ) {\r\n                            return true;\r\n                        }\r\n                    }\r\n                    return false;\r\n                },\r\n                _fnDragStart = function (e, $params) {\r\n                    holderWasShown = false;\r\n\r\n                    if (!$params.hasTouch && (e.button === 2 || e.which === 3)) {\r\n                        // disable right click\r\n                        return;\r\n                    }\r\n                    if (e.uiTreeDragging || (e.originalEvent && e.originalEvent.uiTreeDragging)) { // event has already fired in other scope.\r\n                        return;\r\n                    }\r\n                    // the element which is clicked.\r\n                    var eventElm = angular.element(e.target),\r\n                        eventScope = eventElm.scope();\r\n                    if (!eventScope || !eventScope.$type) {\r\n                        return;\r\n                    }\r\n                    // if (eventScope.$type !== 'TreeDnDNode') { // Check if it is a node or a handle\r\n                    //     return;\r\n                    // }\r\n\r\n                    var currentNode = eventScope.$parent.$modelValue;\r\n                    if (eventScope.$type !== 'TreeDnDNodeHandle') { // If the node has a handle, then it should be clicked by the handle\r\n                        if (eventScope.hasMultiSelect && currentNode && currentNode.parentId !== null) {\r\n                            if (e.ctrlKey) {\r\n                                lastSelectedNode = currentNode;\r\n                                currentNode.__selected = !currentNode.__selected;\r\n                            } else if (e.shiftKey) {\r\n                                var groupNodes = eventScope.$parent.$parent.$parent.$modelValue.__children__;\r\n                                var lastSelectedNodeIdx = (lastSelectedNode && groupNodes.includes(lastSelectedNode)) ? groupNodes.indexOf(lastSelectedNode) : 0;\r\n                                var newSelectedNodeIdx = groupNodes.indexOf(currentNode);\r\n                                var lowerIdx = lastSelectedNodeIdx < newSelectedNodeIdx ? lastSelectedNodeIdx : newSelectedNodeIdx;\r\n                                var higherIdx = lastSelectedNodeIdx > newSelectedNodeIdx ? lastSelectedNodeIdx : newSelectedNodeIdx;\r\n\r\n                                $rootScope.resetNodesSelected();\r\n\r\n                                for (var idx = lowerIdx; idx <= higherIdx; idx++) {\r\n                                    groupNodes[idx].__selected = true;\r\n                                    nodesSelected.push(groupNodes[idx]);\r\n                                }\r\n                            } else {\r\n                                lastSelectedNode = currentNode;\r\n                                $rootScope.resetNodesSelected();\r\n                                currentNode.__selected = true;\r\n                            }\r\n\r\n                            if (nodesSelected.every(function (node) { return node !== currentNode; }) && currentNode.__selected) {\r\n                                nodesSelected.push(currentNode);\r\n                            } else if (nodesSelected.includes(currentNode) && !currentNode.__selected) {\r\n                                nodesSelected.splice(nodesSelected.indexOf(currentNode), 1);\r\n                            }\r\n                        }\r\n                        return;\r\n                    }\r\n                    if (!nodesSelected.includes(currentNode)) {\r\n                        $rootScope.resetNodesSelected();\r\n                    }\r\n\r\n                    var eventElmTagName = eventElm.prop('tagName').toLowerCase(),\r\n                        dragScope,\r\n                        _$scope = $params.$scope;\r\n                    if (eventElmTagName === 'input'\r\n                        || eventElmTagName === 'textarea'\r\n                        || eventElmTagName === 'button'\r\n                        || eventElmTagName === 'select') { // if it's a input or button, ignore it\r\n                        return;\r\n                    }\r\n                    // check if it or it's parents has a 'data-nodrag' attribute\r\n                    while (eventElm && eventElm[0] && eventElm[0] !== $params.element) {\r\n                        if ($TreeDnDHelper.nodrag(eventElm)) { // if the node mark as `nodrag`, DONOT drag it.\r\n                            return;\r\n                        }\r\n                        eventElm = eventElm.parent();\r\n                    }\r\n\r\n                    e.uiTreeDragging = true; // stop event bubbling\r\n                    if (e.originalEvent) {\r\n                        e.originalEvent.uiTreeDragging = true;\r\n                    }\r\n                    e.preventDefault();\r\n\r\n                    dragScope = eventScope.getScopeNode();\r\n\r\n                    $params.firstMoving = true;\r\n\r\n                    if (!_$scope.$callbacks.beforeDrag(dragScope)) {\r\n                        return;\r\n                    }\r\n\r\n                    var eventObj = $TreeDnDHelper.eventObj(e),\r\n                        tagName = dragScope.$element.prop('tagName').toLowerCase(),\r\n                        isTable = (tagName === 'tr');\r\n\r\n                    $params.dragInfo = $TreeDnDHelper.dragInfo(dragScope);\r\n\r\n                    _$scope.setDragging($params.dragInfo);\r\n\r\n                    $params.pos = $TreeDnDHelper.positionStarted(eventObj, dragScope.$element);\r\n\r\n                    if (isTable) {\r\n                        $params.dragElm = angular.element($params.$window.document.createElement('table'))\r\n                            .addClass(_$scope.$class.tree)\r\n                            .addClass(_$scope.$class.drag)\r\n                            .addClass(_$scope.$tree_class);\r\n                    } else {\r\n                        $params.dragElm = angular.element($params.$window.document.createElement('ul'))\r\n                            .addClass(_$scope.$class.drag)\r\n                            .addClass('tree-dnd-nodes')\r\n                            .addClass(_$scope.$tree_class);\r\n                    }\r\n\r\n                    $params.dragElm.css(\r\n                        {\r\n                            'width':   $TreeDnDHelper.width(dragScope.$element) + 'px',\r\n                            'z-index': 9995\r\n                        }\r\n                    );\r\n\r\n                    $params.offsetEdge = 0;\r\n                    var _width = $TreeDnDHelper.width(dragScope.$element),\r\n                        _scope = dragScope,\r\n                        _element = _scope.$element,\r\n                        _clone = null,\r\n                        _needCollapse = !!_$scope.enabledCollapse,\r\n                        _copied = false,\r\n                        _tbody = null;\r\n\r\n                    if (isTable) {\r\n                        $params.offsetEdge = $params.dragInfo.node.__level__ - 1;\r\n                        _tbody = angular.element($params.$window.document.createElement('tbody'));\r\n\r\n                        _$scope.for_all_descendants(\r\n                            $params.dragInfo.node, function (_node) {\r\n                                _scope = _$scope.getScope(_node);\r\n                                _element = _scope.$element;\r\n\r\n                                if (!_copied) {\r\n                                    _clone = _element.clone();\r\n\r\n                                    $TreeDnDHelper.replaceIndent(\r\n                                        _scope,\r\n                                        _clone,\r\n                                        _node.__level__ - $params.offsetEdge,\r\n                                        'padding-left'\r\n                                    );\r\n\r\n                                    _tbody.append(_clone);\r\n\r\n                                    // skip all, just clone parent\r\n                                    if (_needCollapse) {\r\n                                        _copied = true;\r\n                                    }\r\n                                }\r\n\r\n                                if (_$scope.enabledMove && _$scope.$class.hidden) {\r\n                                    _element.addClass(_$scope.$class.hidden);\r\n                                }\r\n                            }\r\n                        );\r\n\r\n                        $params.dragElm.append(_tbody);\r\n                    } else {\r\n\r\n                        if (!_needCollapse) {\r\n                            _clone = _element.clone();\r\n                        } else {\r\n                            var _holder = _scope.getElementChilds(),\r\n                                _swaper = angular.element(\"<swaped />\");\r\n\r\n                            // Insert tag `<holder>` & move _holder into tag `<swaper>`;\r\n                            _holder.after(angular.element(\"<holder />\"));\r\n                            _swaper.append(_holder);\r\n\r\n                            // Clone without Children & remove tag `<holder>`\r\n                            _clone = _element.clone();\r\n                            _clone.find(\"holder\").remove();\r\n\r\n                            // bring childs back frome `swaper` & remove tag `<swaper>`\r\n                            _element.find(\"holder\").replaceWith(_holder);\r\n\r\n                            // Reset & clear all;\r\n                            _swaper.remove();\r\n                            _holder = null;\r\n                        }\r\n\r\n                        $params.dragElm.append(_clone);\r\n                        if (_$scope.enabledMove && _$scope.$class.hidden) {\r\n                            _element.addClass(_$scope.$class.hidden);\r\n                        }\r\n                    }\r\n\r\n                    $params.dragElm.css(\r\n                        {\r\n                            'left': eventObj.pageX - $params.pos.offsetX + _$scope.$callbacks.calsIndent(\r\n                                $params.offsetEdge + 1,\r\n                                true,\r\n                                true\r\n                            )       + 'px',\r\n                            'top':  eventObj.pageY - $params.pos.offsetY + 'px'\r\n                        }\r\n                    );\r\n\r\n                    if (nodesSelected.length > 1) {\r\n                        $params.dragElm.append(angular.element('<div class=\"numBadge\">' + nodesSelected.length + '</div>'));\r\n                    }\r\n\r\n                    // moving item with descendant\r\n                    $params.$document.find('body').append($params.dragElm);\r\n                    if (_$scope.$callbacks.droppable()) {\r\n                        $params.placeElm = _$scope.initPlace(dragScope.$element, $params.dragElm);\r\n\r\n                        if (isTable) {\r\n                            $TreeDnDHelper.replaceIndent(_$scope, $params.placeElm, $params.dragInfo.node.__level__);\r\n                        }\r\n\r\n                        $params.placeElm.css('width', _width);\r\n                    }\r\n\r\n                    _$scope.showPlace();\r\n                    _$scope.targeting = true;\r\n\r\n                    if (_$scope.enabledStatus) {\r\n                        _$scope.refreshStatus();\r\n                        _$scope.setPositionStatus(e);\r\n                    }\r\n\r\n                    angular.element($params.$document).bind('touchend', $params.dragEndEvent);\r\n                    angular.element($params.$document).bind('touchcancel', $params.dragEndEvent);\r\n                    angular.element($params.$document).bind('touchmove', $params.dragMoveEvent);\r\n                    angular.element($params.$document).bind('mouseup', $params.dragEndEvent);\r\n                    angular.element($params.$document).bind('mousemove', $params.dragMoveEvent);\r\n                    angular.element($params.$document).bind('mouseleave', $params.dragCancelEvent);\r\n\r\n                    $params.document_height = Math.max(\r\n                        $params.body.scrollHeight,\r\n                        $params.body.offsetHeight,\r\n                        $params.html.clientHeight,\r\n                        $params.html.scrollHeight,\r\n                        $params.html.offsetHeight\r\n                    );\r\n\r\n                    $params.document_width = Math.max(\r\n                        $params.body.scrollWidth,\r\n                        $params.body.offsetWidth,\r\n                        $params.html.clientWidth,\r\n                        $params.html.scrollWidth,\r\n                        $params.html.offsetWidth\r\n                    );\r\n                },\r\n                _fnDragMove = function (e, $params) {\r\n                    var _$scope = $params.$scope;\r\n                    if (!$params.dragStarted) {\r\n                        if (!$params.dragDelaying) {\r\n                            $params.dragStarted = true;\r\n                            _$scope.$safeApply(\r\n                                function () {\r\n                                    _$scope.$callbacks.dragStart($params.dragInfo);\r\n                                }\r\n                            );\r\n                        }\r\n                        return;\r\n                    }\r\n\r\n                    if (!$params.dragElm) {\r\n                        return;\r\n                    }\r\n\r\n                    e.preventDefault();\r\n                    if ($params.$window.getSelection) {\r\n                        $params.$window.getSelection().removeAllRanges();\r\n                    } else if ($params.$window.document.selection) {\r\n                        $params.$window.document.selection.empty();\r\n                    }\r\n\r\n                    var eventObj = $TreeDnDHelper.eventObj(e),\r\n                        leftElmPos = eventObj.pageX - $params.pos.offsetX,\r\n                        topElmPos = eventObj.pageY - $params.pos.offsetY;\r\n\r\n                    //dragElm can't leave the screen on the left\r\n                    if (leftElmPos < 0) {\r\n                        leftElmPos = 0;\r\n                    }\r\n\r\n                    //dragElm can't leave the screen on the top\r\n                    if (topElmPos < 0) {\r\n                        topElmPos = 0;\r\n                    }\r\n\r\n                    //dragElm can't leave the screen on the bottom\r\n                    if ((topElmPos + 10) > $params.document_height) {\r\n                        topElmPos = $params.document_height - 10;\r\n                    }\r\n\r\n                    //dragElm can't leave the screen on the right\r\n                    if ((leftElmPos + 10) > $params.document_width) {\r\n                        leftElmPos = $params.document_width - 10;\r\n                    }\r\n\r\n                    $params.dragElm.css(\r\n                        {\r\n                            'left': leftElmPos + _$scope.$callbacks.calsIndent(\r\n                                $params.offsetEdge + 1,\r\n                                true,\r\n                                true\r\n                            )       + 'px',\r\n                            'top':  topElmPos + 'px'\r\n                        }\r\n                    );\r\n\r\n                    if (_$scope.enabledStatus) {\r\n                        _$scope.setPositionStatus(e);\r\n                    }\r\n\r\n                    var top_scroll = window.pageYOffset || $params.$window.document.documentElement.scrollTop,\r\n                        bottom_scroll = top_scroll + (window.innerHeight || $params.$window.document.clientHeight || $params.$window.document.clientHeight);\r\n                    // to scroll down if cursor y-position is greater than the bottom position the vertical scroll\r\n                    if (bottom_scroll < eventObj.pageY && bottom_scroll <= $params.document_height) {\r\n                        window.scrollBy(0, 10);\r\n                    }\r\n                    // to scroll top if cursor y-position is less than the top position the vertical scroll\r\n                    if (top_scroll > eventObj.pageY) {\r\n                        window.scrollBy(0, -10);\r\n                    }\r\n\r\n                    $TreeDnDHelper.positionMoved(e, $params.pos, $params.firstMoving);\r\n\r\n                    if ($params.firstMoving) {\r\n                        $params.firstMoving = false;\r\n                        return;\r\n                    }\r\n                    // check if add it as a child node first\r\n\r\n                    var targetX = eventObj.pageX - $params.$window.document.body.scrollLeft,\r\n                        targetY = eventObj.pageY - (window.pageYOffset || $params.$window.document.documentElement.scrollTop),\r\n\r\n                        targetElm,\r\n                        targetScope,\r\n                        targetBefore,\r\n                        targetOffset,\r\n                        tagName,\r\n                        isTable,\r\n                        isChanged = true,\r\n                        isVeritcal = true,\r\n                        isEmpty,\r\n                        isSwapped,\r\n                        _scope,\r\n                        _target,\r\n                        _parent,\r\n                        _info = $params.dragInfo,\r\n                        _move = _info.move,\r\n                        _drag = _info.node,\r\n                        _drop = _info.drop,\r\n                        treeScope = _info.target,\r\n                        fnSwapTree,\r\n                        isHolder = _fnPlaceHolder(e, $params);\r\n\r\n                    if (!isHolder) {\r\n                        /* when using elementFromPoint() inside an iframe, you have to call\r\n                             elementFromPoint() twice to make sure IE8 returns the correct value\r\n                             $params.$window.document.elementFromPoint(targetX, targetY);*/\r\n\r\n                        targetElm = angular.element(\r\n                            $params.$window.document.elementFromPoint(\r\n                                targetX,\r\n                                targetY\r\n                            )\r\n                        );\r\n\r\n                        targetScope = targetElm.scope();\r\n                        if (!targetScope) {\r\n                            return;\r\n                        }\r\n\r\n                        fnSwapTree = function () {\r\n                            treeScope = targetScope.getScopeTree();\r\n                            _target = _info.target;\r\n                            if (_info.target !== treeScope) {\r\n                                if (treeScope.$callbacks.droppable()) {\r\n                                    // Replace by place-holder new\r\n                                    _target.hidePlace();\r\n                                    _target.targeting = false;\r\n                                    treeScope.targeting = true;\r\n\r\n                                    _info.target = treeScope;\r\n                                    $params.placeElm = treeScope.initPlace(targetScope.$element, $params.dragElm);\r\n\r\n                                    _target = null;\r\n                                    isSwapped = true;\r\n                                } else {\r\n                                    // Not allowed Drop Item\r\n                                    return false;\r\n                                }\r\n                            }\r\n                            return true;\r\n                        };\r\n\r\n                        var abortDrag = function () {\r\n                            holderWasShown = false;\r\n                            if (_$scope.enabledStatus) {\r\n                                _$scope.hideStatus();\r\n                            }\r\n                            _$scope.$$apply = false;\r\n                            _fnDragEnd(e, $params);\r\n                        };\r\n\r\n                        if (angular.isFunction(targetScope.getScopeNode)) {\r\n                            targetScope = targetScope.getScopeNode();\r\n\r\n                            if (!fnSwapTree()) {\r\n                                return;\r\n                            }\r\n                        } else {\r\n                            if (holderWasShown) {\r\n                                setTimeout(function () {\r\n                                    // setTimeout is necessary because otherwise the placeholder will not be deleted in some cases\r\n                                    // see: https://stackoverflow.com/questions/779379/why-is-settimeoutfn-0-sometimes-useful\r\n                                    treeScope.placeElm.remove();\r\n                                    abortDrag();\r\n                                }, 0);\r\n                                return;\r\n                            }\r\n\r\n                            if (targetScope.$type === 'TreeDnDNodes' || targetScope.$type === 'TreeDnD') {\r\n                                if (targetScope.tree_nodes) {\r\n                                    if (targetScope.tree_nodes.length === 0) {\r\n                                        if (!fnSwapTree()) {\r\n                                            return;\r\n                                        }\r\n                                        // Empty\r\n                                        isEmpty = true;\r\n                                    }\r\n                                } else {\r\n                                    return;\r\n                                }\r\n                            } else {\r\n                                return;\r\n                            }\r\n                        }\r\n                    } else {\r\n                        holderWasShown = true;\r\n                    }\r\n\r\n                    if ($params.pos.dirAx && !isSwapped || isHolder) {\r\n                        isVeritcal = false;\r\n                        targetScope = _info.scope;\r\n                    }\r\n\r\n                    if (!targetScope.$element && !targetScope) {\r\n                        return;\r\n                    }\r\n\r\n                    tagName = targetScope.$element.prop('tagName').toLowerCase();\r\n                    isTable = (tagName === 'tbody' || tagName === 'table' || tagName === 'tr' || tagName === 'td');\r\n                    if (isEmpty) {\r\n                        _move.parent = null;\r\n                        _move.pos = 0;\r\n\r\n                        _drop = null;\r\n                    } else {\r\n                        // move vertical\r\n                        if (isVeritcal) {\r\n                            targetElm = targetScope.$element; // Get the element of tree-dnd-node\r\n\r\n                            targetOffset = $TreeDnDHelper.offset(targetElm);\r\n\r\n                            if (targetScope.horizontal && !isTable) {\r\n                                targetBefore = eventObj.pageX < (targetOffset.left + $TreeDnDHelper.width(targetElm) / 2);\r\n                            } else {\r\n                                if (isTable) {\r\n                                    targetBefore = eventObj.pageY < (targetOffset.top + $TreeDnDHelper.height(targetElm) / 2);\r\n                                } else {\r\n                                    var _height = $TreeDnDHelper.height(targetElm);\r\n\r\n                                    if (targetScope.getElementChilds()) {\r\n                                        _height -= -$TreeDnDHelper.height(targetScope.getElementChilds());\r\n                                    }\r\n\r\n                                    if (eventObj.pageY > targetOffset.top + _height) {\r\n                                        return;\r\n                                    }\r\n\r\n                                    targetBefore = eventObj.pageY < (targetOffset.top + _height / 2);\r\n                                }\r\n                            }\r\n\r\n                            if (!angular.isFunction(targetScope.getData)) {\r\n                                return;\r\n                            }\r\n\r\n                            _target = targetScope.getData();\r\n                            _parent = targetScope.getNode(_target.__parent_real__);\r\n\r\n                            if (targetBefore) {\r\n                                var _prev = targetScope.getPrevSibling(_target);\r\n\r\n                                _move.parent = _parent;\r\n                                _move.pos = angular.isDefined(_prev) ? _prev.__index__ + 1 : 0;\r\n\r\n                                _drop = _prev;\r\n                            } else {\r\n                                if (_target.__expanded__ && !(_target.__children__.length === 1 && _target.__index_real__ === _drag.__parent_real__)) {\r\n                                    _move.parent = _target;\r\n                                    _move.pos = 0;\r\n\r\n                                    _drop = null;\r\n                                } else {\r\n                                    _move.parent = _parent;\r\n                                    _move.pos = _target.__index__ + 1;\r\n\r\n                                    _drop = _target;\r\n                                }\r\n                            }\r\n                        } else {\r\n                            // move horizontal\r\n                            if ($params.pos.dirAx && $params.pos.distAxX >= treeScope.dragBorder && !treeScope.onlyDeepestDrop) {\r\n                                $params.pos.distAxX = 0;\r\n                                // increase horizontal level if previous sibling exists and is not collapsed\r\n                                if ($params.pos.distX > 0) {\r\n                                    _parent = _drop;\r\n                                    if (!_parent) {\r\n                                        if (_move.pos - 1 >= 0) {\r\n                                            _parent = _move.parent.__children__[_move.pos - 1];\r\n                                        } else {\r\n                                            return;\r\n                                        }\r\n                                    }\r\n\r\n                                    if (_info.drag === _info.target && _parent === _drag && _$scope.enabledMove) {\r\n                                        _parent = treeScope.getPrevSibling(_parent);\r\n                                    }\r\n\r\n                                    if (_parent && _parent.__visible__) {\r\n                                        var _len = _parent.__children__.length;\r\n\r\n                                        _move.parent = _parent;\r\n                                        _move.pos = _len;\r\n\r\n                                        if (_len > 0) {\r\n                                            _drop = _parent.__children__[_len - 1];\r\n                                        } else {\r\n                                            _drop = null;\r\n                                        }\r\n                                    } else {\r\n                                        // Not changed\r\n                                        return;\r\n                                    }\r\n                                } else if ($params.pos.distX < 0) {\r\n                                    _target = _move.parent;\r\n                                    if (_target &&\r\n                                        (_target.__children__.length === 0 ||\r\n                                         _target.__children__.length - 1 < _move.pos ||\r\n                                         (_info.drag === _info.target &&\r\n                                          _target.__index_real__ === _drag.__parent_real__ &&\r\n                                          _target.__children__.length - 1 === _drag.__index__ && _$scope.enabledMove))\r\n                                       ) {\r\n                                        _parent = treeScope.getNode(_target.__parent_real__);\r\n\r\n                                        _move.parent = _parent;\r\n                                        _move.pos = _target.__index__ + 1;\r\n\r\n                                        _drop = _target;\r\n                                    } else {\r\n                                        // Not changed\r\n                                        return;\r\n                                    }\r\n                                } else {\r\n                                    return;\r\n                                }\r\n                            } else if (treeScope.onlyDeepestDrop) {\r\n                                _parent = _drop;\r\n                                if (!_parent) {\r\n                                    return;\r\n                                }\r\n                                if (_parent && _parent.__visible__) {\r\n                                    var _len = _parent.__children__.length;\r\n                                    _move.parent = _parent;\r\n                                    _move.pos = _len;\r\n                                    _drop = null;\r\n                                } else {\r\n                                    // Not changed\r\n                                    return;\r\n                                }\r\n                            } else {\r\n                                // limited\r\n                                return;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    if (_info.drag === _info.target &&\r\n                        _move.parent &&\r\n                        _drag.__parent_real__ === _move.parent.__index_real__ &&\r\n                        _drag.__index__ === _move.pos\r\n                       ) {\r\n                        isChanged = false;\r\n                    }\r\n\r\n                    if (treeScope.$callbacks.accept(_info, _move, isChanged)) {\r\n                        _info.move = _move;\r\n                        _info.drop = _drop;\r\n                        _info.changed = isChanged;\r\n                        _info.scope = targetScope;\r\n\r\n                        if (isTable) {\r\n                            $TreeDnDHelper.replaceIndent(\r\n                                treeScope,\r\n                                $params.placeElm,\r\n                                angular.isUndefinedOrNull(_move.parent) ? 1 : _move.parent.__level__ + 1\r\n                            );\r\n\r\n                            if (_drop) {\r\n                                _parent = (_move.parent ? _move.parent.__children__ : null ) || _info.target.treeData;\r\n\r\n                                if (_drop.__index__ < _parent.length - 1) {\r\n                                    // Find fast\r\n                                    _drop = _parent[_drop.__index__ + 1];\r\n                                    _scope = _info.target.getScope(_drop);\r\n                                    _scope.$element[0].parentNode.insertBefore(\r\n                                        $params.placeElm[0],\r\n                                        _scope.$element[0]\r\n                                    );\r\n                                } else {\r\n                                    _target = _info.target.getLastDescendant(_drop);\r\n                                    _scope = _info.target.getScope(_target);\r\n                                    _scope.$element.after($params.placeElm);\r\n                                }\r\n                            } else {\r\n                                _scope = _info.target.getScope(_move.parent);\r\n                                if (_scope) {\r\n                                    if (_move.parent) {\r\n                                        _scope.$element.after($params.placeElm);\r\n\r\n                                    } else {\r\n                                        _scope.getElementChilds().prepend($params.placeElm);\r\n                                    }\r\n                                }\r\n                            }\r\n                        } else {\r\n                            _scope = _info.target.getScope(_drop || _move.parent);\r\n\r\n                            if (_drop) {\r\n                                _scope.$element.after($params.placeElm);\r\n                            } else {\r\n                                _scope.getElementChilds().prepend($params.placeElm);\r\n                            }\r\n                        }\r\n\r\n                        treeScope.showPlace();\r\n\r\n                        _$scope.$safeApply(\r\n                            function () {\r\n                                _$scope.$callbacks.dragMove(_info);\r\n                            }\r\n                        );\r\n                    }\r\n                },\r\n                _fnDragEnd = function (e, $params) {\r\n                    holderWasShown = false;\r\n\r\n                    e.preventDefault();\r\n                    if ($params.dragElm) {\r\n                        var _passed = false,\r\n                            _$scope = $params.$scope,\r\n                            _scope = _$scope.getScope($params.dragInfo.node),\r\n                            tagName = _scope.$element.prop('tagName').toLowerCase(),\r\n                            _isTable = (tagName === 'tr'),\r\n                            _element = _scope.$element;\r\n\r\n                        _$scope.$safeApply(\r\n                            function () {\r\n                                _passed = _$scope.$callbacks.beforeDrop($params.dragInfo);\r\n                            }\r\n                        );\r\n\r\n                        // rollback all\r\n                        if (_isTable) {\r\n                            _$scope.for_all_descendants(\r\n                                $params.dragInfo.node, function (_node) {\r\n                                    _scope = _$scope.getScope(_node);\r\n                                    _element = _scope.$element;\r\n\r\n                                    if (_scope.$class.hidden) {\r\n                                        _element.removeClass(_$scope.$class.hidden);\r\n                                    }\r\n                                }\r\n                            );\r\n                        } else {\r\n                            if (_$scope.$class.hidden) {\r\n                                _element.removeClass(_$scope.$class.hidden);\r\n                            }\r\n                        }\r\n\r\n                        $params.dragElm.remove();\r\n                        $params.dragElm = null;\r\n\r\n                        if (_$scope.enabledStatus) {\r\n                            _$scope.hideStatus();\r\n                        }\r\n\r\n                        var _status = false;\r\n                        if (_$scope.$$apply) {\r\n                            _$scope.$safeApply(\r\n                                function () {\r\n                                    $params.dragInfo.__multipleNodes = nodesSelected;\r\n                                    $rootScope.resetNodesSelected();\r\n\r\n                                    _status = _$scope.$callbacks.dropped(\r\n                                        $params.dragInfo,\r\n                                        _passed,\r\n                                        _$scope.enabledMove\r\n                                    );\r\n                                }\r\n                            );\r\n                        } else {\r\n                            if ($params && $params.pos === null) {\r\n                                _fnBindDrag($params);\r\n                            }\r\n                        }\r\n\r\n                        _$scope.$safeApply(\r\n                            function () {\r\n                                _$scope.$callbacks.dragStop($params.dragInfo, _status);\r\n                            }\r\n                        );\r\n\r\n                        $params.dragInfo.target.hidePlace();\r\n                        $params.dragInfo.target.targeting = false;\r\n\r\n                        $params.dragInfo = null;\r\n                        _$scope.$$apply = false;\r\n                        _$scope.setDragging(null);\r\n                    }\r\n\r\n                    angular.element($params.$document).unbind('touchend', $params.dragEndEvent); // Mobile\r\n                    angular.element($params.$document).unbind('touchcancel', $params.dragEndEvent); // Mobile\r\n                    angular.element($params.$document).unbind('touchmove', $params.dragMoveEvent); // Mobile\r\n                    angular.element($params.$document).unbind('mouseup', $params.dragEndEvent);\r\n                    angular.element($params.$document).unbind('mousemove', $params.dragMoveEvent);\r\n                    angular.element($params.$window.document.body).unbind('mouseleave', $params.dragCancelEvent);\r\n                },\r\n                _fnDragStartEvent = function (e, $params) {\r\n                    if ($params.$scope.$callbacks.draggable()) {\r\n                        _fnDragStart(e, $params);\r\n                    }\r\n                },\r\n                _fnBindDrag = function ($params) {\r\n                    $params.element.bind(\r\n                        'touchstart mousedown', function (e) {\r\n                            $params.dragDelaying = true;\r\n                            $params.dragStarted = false;\r\n                            _fnDragStartEvent(e, $params);\r\n                            $params.dragTimer = $timeout(\r\n                                function () {\r\n                                    $params.dragDelaying = false;\r\n                                }, $params.$scope.dragDelay\r\n                            );\r\n                        }\r\n                    );\r\n                    $params.element.bind(\r\n                        'touchend touchcancel mouseup', function () {\r\n                            $timeout.cancel($params.dragTimer);\r\n                        }\r\n                    );\r\n                },\r\n                _fnKeydownHandler = function (e, $params) {\r\n                    var _$scope = $params.$scope;\r\n                    if (e.keyCode === 27) {\r\n                        if (_$scope.enabledStatus) {\r\n                            _$scope.hideStatus();\r\n                        }\r\n\r\n                        _$scope.$$apply = false;\r\n                        _fnDragEnd(e, $params);\r\n                    } else {\r\n                        if (_$scope.enabledHotkey && e.shiftKey) {\r\n                            _$scope.enableMove(true);\r\n                            if (_$scope.enabledStatus) {\r\n                                _$scope.refreshStatus();\r\n                            }\r\n\r\n                            if (!$params.dragInfo) {\r\n                                return;\r\n                            }\r\n\r\n                            var _scope = _$scope.getScope($params.dragInfo.node),\r\n                                tagName = _scope.$element.prop('tagName').toLowerCase(),\r\n                                _element = _scope.$element;\r\n\r\n                            if (tagName === 'tr') {\r\n                                _$scope.for_all_descendants(\r\n                                    $params.dragInfo.node, function (_node) {\r\n                                        _scope = _$scope.getScope(_node);\r\n                                        _element = _scope.$element;\r\n\r\n                                        if (_$scope.$class.hidden) {\r\n                                            _element.addClass(_$scope.$class.hidden);\r\n                                        }\r\n                                    }\r\n                                );\r\n                            } else {\r\n                                if (_$scope.$class.hidden) {\r\n                                    _element.addClass(_$scope.$class.hidden);\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                },\r\n                _fnKeyupHandler = function (e, $params) {\r\n                    var _$scope = $params.$scope;\r\n                    if (_$scope.enabledHotkey && !e.shiftKey) {\r\n                        _$scope.enableMove(false);\r\n\r\n                        if (_$scope.enabledStatus) {\r\n                            _$scope.refreshStatus();\r\n                        }\r\n\r\n                        if (!$params.dragInfo) {\r\n                            return;\r\n                        }\r\n\r\n                        var _scope = _$scope.getScope($params.dragInfo.node),\r\n                            tagName = _scope.$element.prop('tagName').toLowerCase(),\r\n                            _element = _scope.$element;\r\n\r\n                        if (tagName === 'tr') {\r\n                            _$scope.for_all_descendants(\r\n                                $params.dragInfo.node, function (_node) {\r\n\r\n                                    _scope = _$scope.getScope(_node);\r\n                                    _element = _scope.$element;\r\n\r\n                                    if (_$scope.$class.hidden) {\r\n                                        _element.removeClass(_$scope.$class.hidden);\r\n                                    }\r\n                                }\r\n                            );\r\n                        } else {\r\n                            if (_$scope.$class.hidden) {\r\n                                _element.removeClass(_$scope.$class.hidden);\r\n                            }\r\n                        }\r\n                    }\r\n                },\r\n\r\n                _$init = function (scope, element, $window, $document) {\r\n                    var $params = {\r\n                        hasTouch:        ('ontouchstart' in window),\r\n                        firstMoving:     null,\r\n                        dragInfo:        null,\r\n                        pos:             null,\r\n                        placeElm:        null,\r\n                        dragElm:         null,\r\n                        dragDelaying:    true,\r\n                        dragStarted:     false,\r\n                        dragTimer:       null,\r\n                        body:            document.body,\r\n                        html:            document.documentElement,\r\n                        document_height: null,\r\n                        document_width:  null,\r\n                        offsetEdge:      null,\r\n                        $scope:          scope,\r\n                        $window:         $window,\r\n                        $document:       $document,\r\n                        element:         element,\r\n                        bindDrag:        function () {\r\n                            _fnBindDrag($params);\r\n                        },\r\n                        dragEnd:         function (e) {\r\n                            _fnDragEnd(e, $params);\r\n                        },\r\n                        dragMoveEvent:   function (e) {\r\n                            _fnDragMove(e, $params)\r\n                        },\r\n                        dragEndEvent:    function (e) {\r\n                            scope.$$apply = true;\r\n                            _fnDragEnd(e, $params);\r\n                        },\r\n                        dragCancelEvent: function (e) {\r\n                            _fnDragEnd(e, $params);\r\n                        }\r\n                    },\r\n                        keydownHandler = function (e) {\r\n                            return _fnKeydownHandler(e, $params);\r\n                        },\r\n                        keyupHandler = function (e) {\r\n                            return _fnKeyupHandler(e, $params);\r\n                        };\r\n\r\n                    scope.dragEnd = function (e) {\r\n                        $params.dragEnd(e);\r\n                    };\r\n\r\n                    $params.bindDrag();\r\n\r\n                    angular.element($window.document.body).bind(\"keydown\", keydownHandler);\r\n                    angular.element($window.document.body).bind(\"keyup\", keyupHandler);\r\n                    //unbind handler that retains scope\r\n                    scope.$on(\r\n                        '$destroy', function () {\r\n                            angular.element($window.document.body).unbind(\"keydown\", keydownHandler);\r\n                            angular.element($window.document.body).unbind(\"keyup\", keyupHandler);\r\n                            if (scope.statusElm) {\r\n                                scope.statusElm.remove();\r\n                            }\r\n\r\n                            if (scope.placeElm) {\r\n                                scope.placeElm.remove();\r\n                            }\r\n                        }\r\n                    );\r\n                };\r\n\r\n            return _$init;\r\n        }\r\n    ]\r\n).factory(\r\n    '$TreeDnDControl', function ($rootScope) {\r\n        var _target, _parent,\r\n            i, len,\r\n            fnSetCollapse = function fnSetCollapse(node) {\r\n                node.__expanded__ = false;\r\n            },\r\n            fnSetExpand = function fnSetExpand(node) {\r\n                node.__expanded__ = true;\r\n            },\r\n\r\n            _$init = function _$init(scope) {\r\n                var n, tree = {\r\n                    selected_node:                     null,\r\n                    for_all_descendants:               scope.for_all_descendants,\r\n                    select_node:                       function (node) {\r\n                        if (!node) {\r\n                            if (tree.selected_node) {\r\n                                delete(tree.selected_node.__selected__);\r\n                            }\r\n                            tree.selected_node = null;\r\n                            return null;\r\n                        }\r\n\r\n                        if (node !== tree.selected_node) {\r\n                            if (tree.selected_node) {\r\n                                delete(tree.selected_node.__selected__);\r\n                            }\r\n                            node.__selected__ = true;\r\n                            tree.selected_node = node;\r\n                            tree.expand_all_parents(node);\r\n                            if (angular.isFunction(tree.on_select)) {\r\n                                tree.on_select(node);\r\n                            }\r\n                        }\r\n                        return node;\r\n                    },\r\n                    deselect_node:                     function () {\r\n                        _target = null;\r\n                        if (tree.selected_node) {\r\n                            delete(tree.selected_node.__selected__);\r\n                            _target = tree.selected_node;\r\n                            tree.selected_node = null;\r\n                        }\r\n                        return _target;\r\n                    },\r\n                    get_parent:                        function (node) {\r\n                        if (node && node.__parent_real__ !== null) {\r\n                            return scope.tree_nodes[node.__parent_real__];\r\n                        }\r\n                        return null;\r\n                    },\r\n                    for_all_ancestors:                 function (child, fn) {\r\n                        _parent = tree.get_parent(child);\r\n                        if (_parent) {\r\n                            if (fn(_parent)) {\r\n                                return false;\r\n                            }\r\n\r\n                            return tree.for_all_ancestors(_parent, fn);\r\n                        }\r\n                        return true;\r\n                    },\r\n                    expand_all_parents:                function (child) {\r\n                        return tree.for_all_ancestors(\r\n                            child, fnSetExpand\r\n                        );\r\n                    },\r\n                    reload_data:                       function () {\r\n                        return scope.reload_data();\r\n                    },\r\n                    add_node:                          function (parent, new_node, index) {\r\n                        if (typeof index !== 'number') {\r\n                            if (parent) {\r\n                                parent.__children__.push(new_node);\r\n                                parent.__expanded__ = true;\r\n                            } else {\r\n                                scope.treeData.push(new_node);\r\n                            }\r\n                        } else {\r\n                            if (parent) {\r\n                                parent.__children__.splice(index, 0, new_node);\r\n                                parent.__expanded__ = true;\r\n                            } else {\r\n                                scope.treeData.splice(index, 0, new_node);\r\n                            }\r\n                        }\r\n                        return new_node;\r\n                    },\r\n                    add_node_root:                     function (new_node) {\r\n                        tree.add_node(null, new_node);\r\n                        return new_node;\r\n                    },\r\n                    expand_all:                        function () {\r\n                        len = scope.treeData.length;\r\n                        for (i = 0; i < len; i++) {\r\n                            tree.for_all_descendants(\r\n                                scope.treeData[i], fnSetExpand\r\n                            );\r\n                        }\r\n                    },\r\n                    collapse_all:                      function () {\r\n                        len = scope.treeData.length;\r\n                        for (i = 0; i < len; i++) {\r\n                            tree.for_all_descendants(\r\n                                scope.treeData[i], fnSetCollapse\r\n                            );\r\n                        }\r\n                    },\r\n                    remove_node:                       function (node) {\r\n                        node = node || tree.selected_node;\r\n                        if (node) {\r\n                            if (node.__parent_real__ !== null) {\r\n                                _parent = tree.get_parent(node).__children__;\r\n                            } else {\r\n                                _parent = scope.treeData;\r\n                            }\r\n\r\n                            _parent.splice(node.__index__, 1);\r\n\r\n                            if (tree.selected_node === node) {\r\n                                tree.selected_node = null;\r\n                            }\r\n                        }\r\n                    },\r\n                    expand_node:                       function (node) {\r\n                        node = node || tree.selected_node;\r\n                        if (node) {\r\n                            node.__expanded__ = true;\r\n                            return node;\r\n                        }\r\n                    },\r\n                    collapse_node:                     function (node) {\r\n                        node = node || tree.selected_node;\r\n                        if (node) {\r\n                            node.__expanded__ = false;\r\n                            return node;\r\n                        }\r\n                    },\r\n                    get_selected_node:                 function () {\r\n                        return tree.selected_node;\r\n                    },\r\n                    get_first_node:                    function () {\r\n                        len = scope.treeData.length;\r\n                        if (len > 0) {\r\n                            return scope.treeData[0];\r\n                        }\r\n                        return null;\r\n                    },\r\n                    get_children:                      function (node) {\r\n                        return node.__children__;\r\n                    },\r\n                    get_siblings:                      function (node) {\r\n                        node = node || tree.selected_node;\r\n                        if (node) {\r\n                            _parent = tree.get_parent(node);\r\n                            if (_parent) {\r\n                                _target = _parent.__children__;\r\n                            } else {\r\n                                _target = scope.treeData;\r\n                            }\r\n                            return _target;\r\n                        }\r\n                    },\r\n                    get_next_sibling:                  function (node) {\r\n                        node = node || tree.selected_node;\r\n                        if (node) {\r\n                            _target = tree.get_siblings(node);\r\n                            n = _target.length;\r\n                            if (node.__index__ < n) {\r\n                                return _target[node.__index__ + 1];\r\n                            }\r\n                        }\r\n                    },\r\n                    get_prev_sibling:                  function (node) {\r\n                        node = node || tree.selected_node;\r\n                        _target = tree.get_siblings(node);\r\n                        if (node.__index__ > 0) {\r\n                            return _target[node.__index__ - 1];\r\n                        }\r\n                    },\r\n                    get_first_child:                   function (node) {\r\n                        node = node || tree.selected_node;\r\n                        if (node) {\r\n                            _target = node.__children__;\r\n                            if (_target && _target.length > 0) {\r\n                                return node.__children__[0];\r\n                            }\r\n                        }\r\n                        return null;\r\n                    },\r\n                    get_closest_ancestor_next_sibling: function (node) {\r\n                        node = node || tree.selected_node;\r\n                        _target = tree.get_next_sibling(node);\r\n                        if (_target) {\r\n                            return _target;\r\n                        }\r\n\r\n                        _parent = tree.get_parent(node);\r\n                        return tree.get_closest_ancestor_next_sibling(_parent);\r\n                    },\r\n                    get_next_node:                     function (node) {\r\n                        node = node || tree.selected_node;\r\n\r\n                        if (node) {\r\n                            _target = tree.get_first_child(node);\r\n                            if (_target) {\r\n                                return _target;\r\n                            } else {\r\n                                return tree.get_closest_ancestor_next_sibling(node);\r\n                            }\r\n                        }\r\n                    },\r\n                    get_prev_node:                     function (node) {\r\n                        node = node || tree.selected_node;\r\n\r\n                        if (node) {\r\n                            _target = tree.get_prev_sibling(node);\r\n                            if (_target) {\r\n                                return tree.get_last_descendant(_target);\r\n                            }\r\n\r\n                            _parent = tree.get_parent(node);\r\n                            return _parent;\r\n                        }\r\n                    },\r\n                    get_last_descendant:               scope.getLastDescendant,\r\n                    select_parent_node:                function (node) {\r\n                        node = node || tree.selected_node;\r\n\r\n                        if (node) {\r\n                            _parent = tree.get_parent(node);\r\n                            if (_parent) {\r\n                                return tree.select_node(_parent);\r\n                            }\r\n                        }\r\n                    },\r\n                    select_first_node:                 function () {\r\n                        return tree.select_node(tree.get_first_node());\r\n                    },\r\n                    select_next_sibling:               function (node) {\r\n                        node = node || tree.selected_node;\r\n\r\n                        if (node) {\r\n                            _target = tree.get_next_sibling(node);\r\n                            if (_target) {\r\n                                return tree.select_node(_target);\r\n                            }\r\n                        }\r\n                    },\r\n                    select_prev_sibling:               function (node) {\r\n                        node = node || tree.selected_node;\r\n\r\n                        if (node) {\r\n                            _target = tree.get_prev_sibling(node);\r\n                            if (_target) {\r\n                                return tree.select_node(_target);\r\n                            }\r\n                        }\r\n                    },\r\n                    select_next_node:                  function (node) {\r\n                        node = node || tree.selected_node;\r\n\r\n                        if (node) {\r\n                            _target = tree.get_next_node(node);\r\n                            if (_target) {\r\n                                return tree.select_node(_target);\r\n                            }\r\n                        }\r\n                    },\r\n                    select_prev_node:                  function (node) {\r\n                        node = node || tree.selected_node;\r\n\r\n                        if (node) {\r\n                            _target = tree.get_prev_node(node);\r\n                            if (_target) {\r\n                                return tree.select_node(_target);\r\n                            }\r\n                        }\r\n                    },\r\n                    reset_selected_nodes:                  function (node) {\r\n                        $rootScope.resetNodesSelected();\r\n                    }\r\n                };\r\n                angular.extend(scope.tree, tree);\r\n                return scope.tree;\r\n            };\r\n\r\n        return _$init;\r\n    }\r\n);\n\nangular.module('template/TreeDnD/TreeDnD.html', []).run(\r\n    [\r\n        '$templateCache', function ($templateCache) {\r\n        $templateCache.put(\r\n            'template/TreeDnD/TreeDnD.html',\r\n            [\"<table ng-class=\\\"$tree_class\\\">\",\r\n             \"    <thead>\",\r\n             \"  <tr>\",\r\n             \"     <th ng-class=\\\"expandingProperty.titleClass\\\" ng-style=\\\"expandingProperty.titleStyle\\\">\",\r\n             \"         {{expandingProperty.displayName || expandingProperty.field || expandingProperty}}\",\r\n             \"        <\\/th>\",\r\n             \"        <th ng-repeat=\\\"col in colDefinitions\\\" ng-class=\\\"col.titleClass\\\" ng-style=\\\"col.titleStyle\\\">\",\r\n             \"         {{col.displayName || col.field}}\",\r\n             \"     </th>\",\r\n             \"    </tr>\",\r\n             \"    </thead>\",\r\n             \" <tbody tree-dnd-nodes=\\\"tree_nodes\\\">\",\r\n             \"  <tr tree-dnd-node=\\\"node\\\" ng-repeat=\\\"node in nodes track by node.__hashKey__ \\\" ng-show=\\\"node.__visible__\\\"\",\r\n             \"       ng-click=\\\"onSelect(node)\\\" ng-class=\\\"(node.__selected__ ? ' active':'')\\\">\",\r\n             \"        <td ng-if=\\\"!expandingProperty.template\\\" tree-dnd-node-handle\",\r\n             \"         ng-style=\\\"expandingProperty.cellStyle ? expandingProperty.cellStyle : {'padding-left': $callbacks.calsIndent(node.__level__)}\\\"\",\r\n             \"          ng-class=\\\"expandingProperty.cellClass\\\"\",\r\n             \"            compile=\\\"expandingProperty.cellTemplate\\\">\",\r\n             \"              <a data-nodrag>\",\r\n             \"                  <i ng-class=\\\"$icon_class\\\" ng-click=\\\"toggleExpand(node)\\\"\",\r\n             \"                     class=\\\"tree-icon\\\"></i>\",\r\n             \"              </a>\",\r\n             \"             {{node[expandingProperty.field] || node[expandingProperty]}}\",\r\n             \"       </td>\",\r\n             \"        <td ng-if=\\\"expandingProperty.template\\\" compile=\\\"expandingProperty.template\\\"></td>\",\r\n             \"        <td ng-repeat=\\\"col in colDefinitions\\\" ng-class=\\\"col.cellClass\\\" ng-style=\\\"col.cellStyle\\\"\",\r\n             \"            compile=\\\"col.cellTemplate\\\">\",\r\n             \"            {{node[col.field]}}\",\r\n             \"       </td>\",\r\n             \"    </tr>\",\r\n             \"    </tbody>\",\r\n             \"</table>\"].join('')\r\n        );\r\n\r\n        $templateCache.put(\r\n            'template/TreeDnD/TreeDnDStatusCopy.html',\r\n            \"<label><i class=\\\"fa fa-copy\\\"></i>&nbsp;<b>Copying</b></label>\"\r\n        );\r\n\r\n        $templateCache.put(\r\n            'template/TreeDnD/TreeDnDStatusMove.html',\r\n            '<label><i class=\"fa fa-file-text\"></i>&nbsp;<b>Moving</b></label>'\r\n        );\r\n    }]\r\n);\r\n\r\n}).call(window);"]}
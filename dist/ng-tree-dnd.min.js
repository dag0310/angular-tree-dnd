/**
 * The MIT License (MIT)
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 */
/**
 * Implementing TreeDnD & Event DrapnDrop (allow drag multi tree-table include all type: table, ol, ul)
 * Demo: http://thienhung1989.github.io/angular-tree-dnd
 * Github: https://github.com/thienhung1989/angular-tree-dnd
 * @version 3.2.5
 * (c) 2015 Nguyuễn Thiện Hùng - <nguyenthienhung1989@gmail.com>
 */
(function(){"use strict";angular.isUndefinedOrNull=function(e){return angular.isUndefined(e)||null===e},angular.isDefined=function(e){return!(angular.isUndefined(e)||null===e)},angular.module("ntt.TreeDnD",["template/TreeDnD/TreeDnD.html"]).constant("$TreeDnDClass",{tree:"tree-dnd",empty:"tree-dnd-empty",hidden:"tree-dnd-hidden",node:"tree-dnd-node",nodes:"tree-dnd-nodes",handle:"tree-dnd-handle",place:"tree-dnd-placeholder",drag:"tree-dnd-drag",status:"tree-dnd-status",icon:{1:"glyphicon glyphicon-minus",0:"glyphicon glyphicon-plus","-1":"glyphicon glyphicon-file"}}).directive("compile",["$compile",function(e){return{restrict:"A",link:function(n,t,a){n.$watch(a.compile,function(a){if(a){var l=e(a),r=l(n);angular.isFunction(t.empty)?t.empty():t.html(""),t.append(r)}})}}}]).directive("compileReplace",["$compile",function(e){return{restrict:"A",link:function(n,t,a){n.$watch(a.compileReplace,function(a){if(a){var l=e(a),r=l(n);t.replaceWith(r)}})}}}]).directive("treeDndNodeHandle",function(){return{restrict:"A",scope:!0,link:function(e,n,t){e.$element=n,e.$type="TreeDnDNodeHandle",e.$class.handle&&n.addClass(e.$class.handle)}}}).directive("treeDndNode",function(){return{restrict:"A",replace:!0,link:function(e,n,t){var a="boolean"==typeof e.dragEnabled||"boolean"==typeof e.dropEnabled;e.$modelValue=null,e.$icon_class="",e.$node_class="",e.$class.node&&(n.addClass(e.$class.node),e.$node_class=e.$class.node),e.$watch(t.treeDndNode,function(e,n,t){a&&t.setScope(t,e),t.$modelValue=e,t.$icon_class=t.$class.icon[e.__icon__]},!0),a&&(e.$element=n,e.$type="TreeDnDNode",e.getScopeNode=function(){return e},e.getData=function(){return e.$modelValue},e.getElementChilds=function(){return angular.element(n[0].querySelector("[tree-dnd-nodes]"))})}}}).directive("treeDndNodes",function(){return{restrict:"A",replace:!0,link:function(e,n,t){e.nodes=[],e.$nodes_class="",e.$type="TreeDnDNodes",e.$element=n,e.getScopeNode=null,e.$watch(t.treeDndNodes,function(e,n,t){t.nodes=e},!0),e.$class.nodes&&(n.addClass(e.$class.nodes),e.$nodes_class=e.$class.nodes)}}}).directive("treeDnd",["$injector","$timeout","$http","$compile","$window","$document","$templateCache","$TreeDnDTemplate","$TreeDnDClass","$TreeDnDHelper","$TreeDnDPlugin",function(e,n,t,a,l,r,o,i,d,s,c){return{restrict:"E",scope:!0,replace:!0,controller:["$scope","$element","$attrs",function(e,n,t){e.indent=20,e.indent_plus=15,e.indent_unit="px",e.$tree_class="table",e.primary_key="__uid__",e.hasMultiSelect="true"===t.hasMultiSelect,e.onlyDeepestDrop="true"===t.onlyDeepestDrop,e.$type="TreeDnD",e.colDefinitions=[],e.$globals={},e.$class={},e.treeData=[],e.tree_nodes=[],e.sycning=!1,e.$class=angular.copy(d),angular.extend(e.$class.icon,{1:t.iconExpand||"glyphicon glyphicon-minus",0:t.iconCollapse||"glyphicon glyphicon-plus","-1":t.iconLeaf||"glyphicon glyphicon-file"}),e.for_all_descendants=function(n,t){if(angular.isFunction(t)){var a,l,r;if(t(n))return!1;for(r=n.__children__,l=r.length,a=0;a<l;a++)if(!e.for_all_descendants(r[a],t))return!1}return!0},e.getLastDescendant=function(n){var t,a;return n||(n=!!e.tree&&e.tree.selected_node),n!==!1&&(a=n.__children__.length,0===a?n:(t=n.__children__[a-1],e.getLastDescendant(t)))},e.getElementChilds=function(){return angular.element(n[0].querySelector("[tree-dnd-nodes]"))},e.onClick=function(n){angular.isDefined(e.tree)&&angular.isFunction(e.tree.on_click)&&setTimeout(function(){e.tree.on_click(n)},0)},e.onSelect=function(n){angular.isDefined(e.tree)&&(n!==e.tree.selected_node&&e.tree.select_node(n),angular.isFunction(e.tree.on_select)&&setTimeout(function(){e.tree.on_select(n)},0))};var a,o;e.toggleExpand=function(n,t){a=!0,angular.isFunction(t)&&!t(n)?a=!1:angular.isFunction(e.$callbacks.expand)&&!e.$callbacks.expand(n)&&(a=!1),a&&n.__children__.length>0&&(n.__expanded__=!n.__expanded__)},e.getHash=function(n){return"__uid__"===e.primary_key?"#"+n.__parent__+"#"+n.__uid__:"#"+n.__parent__+"#"+n[e.primary_key]},e.$callbacks={for_all_descendants:e.for_all_descendants,expand:function(e){return!0},accept:function(n,t,a){return e.dropEnabled===!0},calsIndent:function(n,t,a){var l=0,r=a?0:e.indent_plus;return t||(l=e.indent_unit?e.indent_unit:"px"),n-1<1?r+l:e.indent*(n-1)+r+l},droppable:function(){return e.dropEnabled===!0},draggable:function(){return e.dragEnabled===!0},beforeDrop:function(e){return!0},changeKey:function(n){var t=n.__uid__;n.__uid__=Math.random(),n.__selected__&&delete n.__selected__,"__uid__"!==e.primary_key&&(t=""+n[e.primary_key],t=t.replace(/_#.+$/g,"")+"_#"+n.__uid__,n[e.primary_key]=t)},clone:function(e,n){return o=angular.copy(e),this.for_all_descendants(o,this.changeKey),o},remove:function(e,n,t){return n.splice(e.__index__,1)[0]},add:function(e,n,t,a){t&&(t.length>-1&&n>-1?t.splice(n,0,e):t.push(e))}},(t.enableDrag||t.enableDrop)&&(e.placeElm=null,e.dragEnabled=null,e.dropEnabled=null,e.horizontal=null,t.enableDrag&&(e.dragDelay=0,e.enabledMove=!0,e.statusMove=!0,e.enabledHotkey=!1,e.enabledCollapse=null,e.statusElm=null,e.dragging=null,angular.extend(e.$callbacks,{beforeDrag:function(e){return!0},dragStop:function(e,n){},dropped:function(e,n,t){if(!e)return null;if(!e.changed&&t)return!1;var a=e.node,l=null,r=e.move,o=null,i=e.parent||e.drag.treeData,d=r.parent||e.target.treeData;return!!e.target.$callbacks.accept(e,e.move,e.changed)&&(t?(o=i,angular.isDefined(o.__children__)&&(o=o.__children__),l=e.drag.$callbacks.remove(a,o,e.drag.$callbacks)):l=e.drag.$callbacks.clone(a,e.drag.$callbacks),t&&e.drag===e.target&&i===d&&r.pos>=e.node.__index__&&r.pos--,o=d,o.__children__&&(o=o.__children__),e.target.$callbacks.add(l,r.pos,o,e.drag.$callbacks),!0)},dragStart:function(e){},dragMove:function(e){}}),e.setDragging=function(n){e.dragging=n},e.enableMove=function(n){"boolean"==typeof n?e.enabledMove=n:e.enabledMove=!0},t.enableStatus&&(e.enabledStatus=!1,e.hideStatus=function(){e.statusElm&&e.statusElm.addClass(e.$class.hidden)},e.refreshStatus=function(){if(e.dragging&&e.enabledStatus){var n=e.statusElm;e.enabledMove?e.statusElm=angular.element(i.getMove(e)):e.statusElm=angular.element(i.getCopy(e)),n!==e.statusElm&&(n&&(e.statusElm.attr("class",n.attr("class")),e.statusElm.attr("style",n.attr("style")),n.remove()),r.find("body").append(e.statusElm)),e.statusElm.removeClass(e.$class.hidden)}},e.setPositionStatus=function(n){e.statusElm&&(e.statusElm.css({left:n.pageX+10+"px",top:n.pageY+15+"px","z-index":9999}),e.statusElm.addClass(e.$class.status))})),e.targeting=!1,e.getPrevSibling=function(n){if(n&&n.__index__>0){var t,a=n.__index__-1;return angular.isDefined(n.__parent_real__)?(t=e.tree_nodes[n.__parent_real__],t.__children__[a]):e.treeData[a]}return null},e.getNode=function(n){return angular.isUndefinedOrNull(n)?null:e.tree_nodes[n]},e.setScope=function(n,t){var a=e.getHash(t);e.$globals[a]!==n&&(e.$globals[a]=n)},e.getScope=function(n){return n?e.$globals[e.getHash(n)]:e},e.initPlace=function(n,t){var a=null,r=!1;if(n?(a=n.prop("tagName").toLowerCase(),r="tr"===a||"td"===a):(a=e.getElementChilds().prop("tagName").toLowerCase(),r="tbody"===a||"table"===a),!e.placeElm)if(r){e.placeElm=angular.element(l.document.createElement("tr"));var o=e.colDefinitions.length;for(e.placeElm.append(angular.element(l.document.createElement("td")).addClass(e.$class.empty).addClass("indented").addClass(e.$class.place));o-- >0;)e.placeElm.append(angular.element(l.document.createElement("td")).addClass(e.$class.empty).addClass(e.$class.place))}else e.placeElm=angular.element(l.document.createElement("li")).addClass(e.$class.empty).addClass(e.$class.place);return t&&e.placeElm.css("height",s.height(t)+"px"),n?n[0].parentNode.insertBefore(e.placeElm[0],n[0]):e.getElementChilds().append(e.placeElm),e.placeElm},e.hidePlace=function(){e.placeElm&&e.placeElm.addClass(e.$class.hidden)},e.showPlace=function(){e.placeElm&&e.placeElm.removeClass(e.$class.hidden)},e.getScopeTree=function(){return e}),e.$safeApply=function(e){var n=this.$root.$$phase;"$apply"===n||"$digest"===n?e&&"function"==typeof e&&e():this.$apply(e)}}],compile:function(e,n){var d="",s=e.html().trim();return s.length>0&&(d=s,e.html("")),function(e,s,u){var _,g,f,p,m,h,$,b,y,v,D,E,x,w,C,S,k=function(){if(e.treeData&&e.treeData.length){var n,t,a=e.treeData[0],l=Object.keys(a),r=new RegExp("^__([a-zA-Z0-9_-]*)__$");for(t=0,n=l.length;t<n;t++)if("string"==typeof a[l[t]]&&!r.test(l[t]))return void(e.expandingProperty=l[t]);angular.isUndefinedOrNull(e.expandingProperty)&&(e.expandingProperty=l[0])}},T=function(){if(e.treeData.length){var n,t,a=[],l=e.treeData[0],r=new RegExp("(^__([a-zA-Z0-9_-]*)__$|^"+e.expandingProperty+"$)"),o=Object.keys(l);for(n=0,t=o.length;n<t;n++)"string"!=typeof l[o[n]]||r.test(o[n])||a.push({field:o[n]});e.colDefinitions=a}},M=function(n,t,a,l,r,o,i){var d,s,c,u,_,g;if(angular.isArray(t.__children__)||(t.__children__=[]),t.__parent_real__=l,t.__parent__=a,s=t.__children__.length,angular.isUndefinedOrNull(t.__expanded__)&&s>0&&(t.__expanded__=r<e.expandLevel),c=0===s?-1:t.__expanded__?1:0,u=n.length,t.__index__=i,t.__index_real__=u,t.__level__=r,t.__icon__=c,t.__visible__=!!o,angular.isUndefinedOrNull(t.__uid__)&&(t.__uid__=""+Math.random()),n.push(t),_=1,s>0)for(d=0;d<s;d++)_+=M(n,t.__children__[d],"__uid__"===e.primary_key?t.__uid__:t[e.primary_key],u,r+1,o&&t.__expanded__,d);return g=e.getHash(t),(angular.isUndefinedOrNull(t.__hashKey__)||t.__hashKey__!==g)&&(t.__hashKey__=g),t.__dept__=_,_},A=function(n){var t,a,l=[];if(angular.isDefined(n)){if(!angular.isArray(n)||0===n.length)return[];t=n}else{if(!angular.isArray(e.treeData)||0===e.treeData.length)return[];t=e.treeData}if(u.expandOn||k(),u.columnDefs||T(),angular.isDefined(e.orderBy)&&(angular.isFunction(g)||(g=c("$TreeDnDOrderBy")),angular.isFunction(g)&&(t=g(t,e.orderBy))),angular.isDefined(e.filter)&&(angular.isFunction(_)||(_=c("$TreeDnDFilter")),angular.isFunction(_)&&(t=_(t,e.filter,e.filterOptions))),a=t.length,a>0){var r,o,i,d,s,f=0;for(r=0;r<a;r++)f+=M(l,t[r],null,null,1,!0,r);if(s=Object.keys(e.$globals),a=e.$globals.length,o=a-f,0!==o)for(i=a-o,d=i-Math.abs(o),r=d;r<i;r++)delete e.$globals[s[r]]}return angular.isDefined(e.tree_nodes)&&delete e.tree_nodes,e.tree_nodes=l,l},P={showParent:!0,showChild:!1,beginAnd:!0},N=function(e,n,t){return!angular.isUndefinedOrNull(n)&&("*"===n||!angular.isUndefined(e[n])||(angular.isArray(n)?Y(e,n,t):void 0))},Y=function(e,n,t){var a,l=n.length,r=!1;if(0===l)return null;for(a=0;a<l;a++)if(N(e,n[a],!t)){if(r=!0,!t)return!0}else if(t)return!1;return r},X=function(t,a,l,r,o,i,d){if(r=r||a,"string"==typeof t||angular.isArray(t)){if(angular.isFunction(d)&&d())return;"string"==typeof n[a]?e.$watch(n[a],function(e,n,a){"string"==typeof t&&typeof e===t||angular.isArray(t)&&t.indexOf(typeof e)>-1?a[r]=e:angular.isFunction(l)?a[r]=l(e):a[r]=l,angular.isFunction(i)&&i(a[r],a)},!0):angular.isFunction(o)?e[r]=o():angular.isUndefined(o)||(e[r]=o)}},O=[["enableDrag",[["boolean","enableStatus",null,"enabledStatus"],["boolean","enableMove",null,"enabledMove"],["number","dragDelay",0,null,0],["boolean","enableCollapse",null,"enabledCollapse"],["boolean","enableHotkey",null,"enabledHotkey",null,function(n){n?e.enabledMove=!1:e.enabledMove=e.statusMove}]]],[["enableDrag","enableStatus"],[["string","templateCopy",u.templateCopy,"templateCopy",null,function(n){n&&o.get(n)&&i.setCopy(n,e)}],["string","templateMove",u.templateMove,"templateMove",null,function(n){n&&o.get(n)&&i.setMove(n,e)}]]],[[["enableDrag","enableDrop"]],[["number","dragBorder",30,"dragBorder",30]]],["*",[["boolean","horizontal"],["callback","treeClass",function(n){switch(typeof n){case"string":e.$tree_class=n;break;case"object":angular.extend(e.$class,n),e.$tree_class=e.$class.tree;break;default:e.$tree_class=u.treeClass}},"treeClass",function(){e.$tree_class=e.$class.tree+" table"},null,function(){if(/^(\s+[\w\-]+){2,}$/g.test(" "+u.treeClass))return e.$tree_class=u.treeClass.trim(),!0}],[["object","string"],"expandOn",k,"expandingProperty",k,function(n){angular.isUndefinedOrNull(n)&&(e.expandingProperty=u.expandOn)}],["object","treeControl",angular.isDefined(e.tree)?e.tree:{},"tree",null,function(n){angular.isFunction(f)||(f=c("$TreeDnDControl")),angular.isFunction(f)&&(m=angular.extend(n,f(e)))}],[["array","object"],"columnDefs",T,"colDefinitions",T,function(n){!angular.isUndefinedOrNull(n)&&angular.isArray(n)||(e.colDefinitions=T())}],[["object","string","array","function"],"orderBy",u.orderBy],[["object","array"],"filter",null,"filter",null,function(n){var t=!1;if(angular.isDefined(n)&&!angular.isArray(n)){var a,l=Object.keys(n),r=l.length;if(r>0)for(a=0;a<r;a++)if("string"!=typeof n[l[a]]||0!==n[l[a]].length){t=!0;break}}e.enabledFilter=t,A()}],["object","filterOptions",P,"filterOptions",P,function(n){"object"==typeof n&&(e.filterOptions=angular.extend(P,n))}],["string","primaryKey",u.primaryKey,"primary_key","__uid__"],["string","indentUnit",u.indentUnit,"indent_unit"],["number","indent",30,null,30],["number","indentPlus",20,null,20],["null","callbacks",function(n){return angular.forEach(n,function(n,t){"function"==typeof n&&e.$callbacks[t]&&(e.$callbacks[t]=n)}),e.$callbacks},"$callbacks"],["number","expandLevel",3,"expandLevel",3,function(){A()}],["boolean","enableDrag",null,"dragEnabled"],["boolean","enableDrop",null,"dropEnabled"]]]],I=O.length;for(h=0;h<I;h++)if(N(u,O[h][0],!0))for(y=O[h][1],$=0,b=y.length;$<b;$++)v=y[$][0],D=y[$][1],E=y[$][2],x=y[$][3],w=y[$][4],C=y[$][5],S=y[$][6],X(v,D,E,x,w,C,S);u.treeData&&e.$watch(u.treeData,function(n){e.treeData=n},!0),e.$watch("treeData",function(e){A(e)},!0),e.reload_data=A,u.enableDrag&&(p=c("$TreeDnDDrag"),angular.isFunction(p)&&p(e,s,l,r)),e.$safeApply(function(){d.length>0?s.append(a(d)(e)):t.get(u.templateUrl||i.getPath(),{cache:o}).success(function(n){s.append(a(n.trim())(e))})})}}}}]).factory("$TreeDnDConvert",function(){var e={line2tree:function(e,n,t){if(!e||0===e.length||!n||!t)return[];for(var a,l,r=[],o=[],i=e[0],d=i[n],s={},c=e.length,u=0;u<c;)i=e[u++],d=i[n],s[d]=i,a=i[t],a?(l=s[a],l.__children__?l.__children__.push(i):l.__children__=[i]):o.push(d);for(c=o.length,u=0;u<c;u++)r.push(s[o[u]]);return r},tree2tree:function(e,n){var t=function(e){var a,l,r,o=[],i=e.length;for(a=0;a<i;a++)l=angular.copy(e[a]),angular.isArray(l[n])&&l[n].length>0&&(r=t(l[n]),delete l[n],l.__children__=r),o.push(l);return o};return t(e)}};return e}).factory("$TreeDnDHelper",["$document","$window",function(e,n){var t={nodrag:function(e){return"undefined"!=typeof e.attr("data-nodrag")},eventObj:function(e){var n=e;return void 0!==e.targetTouches?n=e.targetTouches.item(0):void 0!==e.originalEvent&&void 0!==e.originalEvent.targetTouches&&(n=e.originalEvent.targetTouches.item(0)),n},dragInfo:function(e){var n=e.getData(),t=e.getScopeTree(),a=e.getNode(n.__parent_real__);return{node:n,parent:a,move:{parent:a,pos:n.__index__},scope:e,target:t,drag:t,drop:e.getPrevSibling(n),changed:!1}},height:function(e){return e.prop("scrollHeight")},width:function(e){return e.prop("scrollWidth")},offset:function(t){var a=t[0].getBoundingClientRect();return{width:t.prop("offsetWidth"),height:t.prop("offsetHeight"),top:a.top+(n.pageYOffset||e[0].body.scrollTop||e[0].documentElement.scrollTop),left:a.left+(n.pageXOffset||e[0].body.scrollLeft||e[0].documentElement.scrollLeft)}},positionStarted:function(e,n){var t={};return t.offsetX=e.pageX-this.offset(n).left,t.offsetY=e.pageY-this.offset(n).top,t.startX=t.lastX=e.pageX,t.startY=t.lastY=e.pageY,t.nowX=t.nowY=t.distX=t.distY=t.dirAx=0,t.dirX=t.dirY=t.lastDirX=t.lastDirY=t.distAxX=t.distAxY=0,t},positionMoved:function(e,n,t){n.lastX=n.nowX,n.lastY=n.nowY,n.nowX=e.pageX,n.nowY=e.pageY,n.distX=n.nowX-n.lastX,n.distY=n.nowY-n.lastY,n.lastDirX=n.dirX,n.lastDirY=n.dirY,n.dirX=0===n.distX?0:n.distX>0?1:-1,n.dirY=0===n.distY?0:n.distY>0?1:-1;var a=Math.abs(n.distX)>Math.abs(n.distY)?1:0;return t?(n.dirAx=a,void(n.moving=!0)):(n.dirAx!==a?(n.distAxX=0,n.distAxY=0):(n.distAxX+=Math.abs(n.distX),0!==n.dirX&&n.dirX!==n.lastDirX&&(n.distAxX=0),n.distAxY+=Math.abs(n.distY),0!==n.dirY&&n.dirY!==n.lastDirY&&(n.distAxY=0)),void(n.dirAx=a))},replaceIndent:function(e,n,t,a){a=a?a:"left",angular.element(n.children()[0]).css(a,e.$callbacks.calsIndent(t))}};return t}]).factory("$TreeDnDPlugin",["$injector",function(e){var n=function(n){return angular.isDefined(e)&&e.has(n)?e.get(n):null};return n}]).factory("$TreeDnDTemplate",["$templateCache",function(e){var n,t="template/TreeDnD/TreeDnD.html",a="template/TreeDnD/TreeDnDStatusCopy.html",l="template/TreeDnD/TreeDnDStatusMove.html",r={},o={setMove:function(e,n){r[n.$id]||(r[n.$id]={}),r[n.$id].movePath=e},setCopy:function(e,n){r[n.$id]||(r[n.$id]={}),r[n.$id].copyPath=e},getPath:function(){return t},getCopy:function(t){return r[t.$id]&&r[t.$id].copyPath&&(n=e.get(r[t.$id].copyPath))?n:e.get(a)},getMove:function(t){return r[t.$id]&&r[t.$id].movePath&&(n=e.get(r[t.$id].movePath))?n:e.get(l)}};return o}]).factory("$TreeDnDFilter",["$filter",function(e){var n,t,a,l,r,o=function f(e,n,t,a,l,r){if(!angular.isFunction(a))return null;var o,i,d,s=a(e,n),c=!1;if(angular.isDefined(n[t]))for(d=n[t],i=d.length,o=0;o<i;o++)c=f(e,d[o],t,a,l,s||r)||c;return angular.isFunction(l)&&l(e,n,s===!0,c===!0,r===!0),s||c},i=function(n,t){if(angular.isUndefinedOrNull(t)||angular.isArray(t))return null;if(angular.isFunction(n))return n(t,e);if("boolean"==typeof n)return t=!!t,t===n;if(!angular.isDefined(n))return null;try{var a=new RegExp(n);return a.test(t)}catch(l){return"string"==typeof t?t.indexOf(n)>-1:null}},d=function(e,n,t){if(angular.isArray(n))return s(e,n,t);var a,l,r,o=n.field,d=n.callback;if("_$"===o){for(l=Object.keys(e),r=l.length,a=0;a<r;a++)if(i(d,e[l[a]]))return!0}else if(angular.isDefined(e[o]))return i(d,e[o])},s=function(e,n,t){var a,l=n.length,r=!1;if(0===l)return null;for(a=0;a<l;a++)if(d(e,n[a],!t)){if(r=!0,!t)return!0}else if(t)return!1;return r},c=function(e,n,t,a,l){return t===!0?(n.__filtered__=!0,void(n.__filtered_visible__=!0)):a===!0&&e.showParent===!0||l===!0&&e.showChild===!0?(n.__filtered__=!1,void(n.__filtered_visible__=!0)):(delete n.__filtered__,void delete n.__filtered_visible__)},u=function(e,n){return 0===e.filter.length||d(n,e.filter,e.beginAnd||!1)},_=function p(e){if(angular.isObject(e)&&!angular.isArray(e)){if(a=Object.keys(e),t=a.length,l=[],t>0)for(n=0;n<t;n++)"string"==typeof e[a[n]]&&0===e[a[n]].length||(r=angular.isArray(e[a[n]])?e[a[n]]:angular.isObject(e[a[n]])?p(e[a[n]]):{field:a[n],callback:e[a[n]]},l.push(r));return r=null,l}return e},g=function(e,n,t){if(!angular.isArray(e)||0===e.length||!angular.isArray(n)&&!angular.isObject(n)||0===n.length)return e;var a,l,r;if(r=_(n),!angular.isArray(r)&&!angular.isObject(r)||0===r.length)return e;for(t.filter=r,a=0,l=e.length;a<l;a++)o(t,e[a],"__children__",u,c);return e};return g}]).factory("$TreeDnDOrderBy",["$filter",function(e){var n=e("orderBy"),t=function r(e,n,t,a){var l,o,i;if(angular.isDefined(n[t])){for(i=n[t],o=i.length,l=0;l<o;l++)i[l]=r(e,i[l],t,a);n[t]=a(n[t],e)}return n},a=function(e,t){return n(e,t)},l=function(e,n){if(!angular.isArray(e)||0===e.length||!(angular.isArray(n)||angular.isObject(n)||angular.isString(n)||angular.isFunction(n))||0===n.length&&!angular.isFunction(n))return e;var l,r;for(l=0,r=e.length;l<r;l++)e[l]=t(n,e[l],"__children__",a);return e=a(e,n)};return l}]).factory("$TreeDnDDrag",["$rootScope","$timeout","$TreeDnDHelper",function(e,n,t){var a,l=!1,r=[],o=null;e.resetNodesSelected=function(){r.forEach(function(e){e.__selected=!1}),r=[],o=null};var i,d=function(e,n){return!!(n.placeElm&&(i=t.offset(n.placeElm),i.top<=e.pageY&&e.pageY<=i.top+i.height&&i.left<=e.pageX&&e.pageX<=i.left+i.width))},s=function(n,a){if(l=!1,(a.hasTouch||2!==n.button&&3!==n.which)&&!(n.uiTreeDragging||n.originalEvent&&n.originalEvent.uiTreeDragging)){var i=angular.element(n.target),d=i.scope();if(d&&d.$type){var s=d.$parent.$modelValue;if("TreeDnDNodeHandle"===d.$type){r.includes(s)||e.resetNodesSelected();var c,u=i.prop("tagName").toLowerCase(),_=a.$scope;if("input"!==u&&"textarea"!==u&&"button"!==u&&"select"!==u){for(;i&&i[0]&&i[0]!==a.element;){if(t.nodrag(i))return;i=i.parent()}if(n.uiTreeDragging=!0,n.originalEvent&&(n.originalEvent.uiTreeDragging=!0),n.preventDefault(),c=d.getScopeNode(),a.firstMoving=!0,_.$callbacks.beforeDrag(c)){var g=t.eventObj(n),f=c.$element.prop("tagName").toLowerCase(),p="tr"===f;a.dragInfo=t.dragInfo(c),_.setDragging(a.dragInfo),a.pos=t.positionStarted(g,c.$element),p?a.dragElm=angular.element(a.$window.document.createElement("table")).addClass(_.$class.tree).addClass(_.$class.drag).addClass(_.$tree_class):a.dragElm=angular.element(a.$window.document.createElement("ul")).addClass(_.$class.drag).addClass("tree-dnd-nodes").addClass(_.$tree_class),a.dragElm.css({width:t.width(c.$element)+"px","z-index":9995}),a.offsetEdge=0;var m=t.width(c.$element),h=c,$=h.$element,b=null,y=!!_.enabledCollapse,v=!1,D=null;if(p)a.offsetEdge=a.dragInfo.node.__level__-1,D=angular.element(a.$window.document.createElement("tbody")),_.for_all_descendants(a.dragInfo.node,function(e){h=_.getScope(e),$=h.$element,v||(b=$.clone(),t.replaceIndent(h,b,e.__level__-a.offsetEdge,"padding-left"),D.append(b),y&&(v=!0)),_.enabledMove&&_.$class.hidden&&$.addClass(_.$class.hidden)}),a.dragElm.append(D);else{if(y){var E=h.getElementChilds(),x=angular.element("<swaped />");E.after(angular.element("<holder />")),x.append(E),b=$.clone(),b.find("holder").remove(),$.find("holder").replaceWith(E),x.remove(),E=null}else b=$.clone();a.dragElm.append(b),_.enabledMove&&_.$class.hidden&&$.addClass(_.$class.hidden)}a.dragElm.css({left:g.pageX-a.pos.offsetX+_.$callbacks.calsIndent(a.offsetEdge+1,!0,!0)+"px",top:g.pageY-a.pos.offsetY+"px"}),r.length>1&&a.dragElm.append(angular.element('<div class="numBadge">'+r.length+"</div>")),a.$document.find("body").append(a.dragElm),_.$callbacks.droppable()&&(a.placeElm=_.initPlace(c.$element,a.dragElm),p&&t.replaceIndent(_,a.placeElm,a.dragInfo.node.__level__),a.placeElm.css("width",m)),_.showPlace(),_.targeting=!0,_.enabledStatus&&(_.refreshStatus(),_.setPositionStatus(n)),angular.element(a.$document).bind("touchend",a.dragEndEvent),angular.element(a.$document).bind("touchcancel",a.dragEndEvent),angular.element(a.$document).bind("touchmove",a.dragMoveEvent),angular.element(a.$document).bind("mouseup",a.dragEndEvent),angular.element(a.$document).bind("mousemove",a.dragMoveEvent),angular.element(a.$document).bind("mouseleave",a.dragCancelEvent),a.document_height=Math.max(a.body.scrollHeight,a.body.offsetHeight,a.html.clientHeight,a.html.scrollHeight,a.html.offsetHeight),a.document_width=Math.max(a.body.scrollWidth,a.body.offsetWidth,a.html.clientWidth,a.html.scrollWidth,a.html.offsetWidth)}}}else if(d.hasMultiSelect&&s&&null!==s.parentId){if(n.ctrlKey)o=s,s.__selected=!s.__selected;else if(n.shiftKey){var w=d.$parent.$parent.$parent.$modelValue.__children__,C=o&&w.includes(o)?w.indexOf(o):0,S=w.indexOf(s),k=C<S?C:S,T=C>S?C:S;e.resetNodesSelected(),o=w[C];for(var M=k;M<=T;M++)w[M].__selected=!0,r.push(w[M])}else e.resetNodesSelected(),o=s,s.__selected=!0;r.every(function(e){return e!==s})&&s.__selected?r.push(s):r.includes(s)&&!s.__selected&&r.splice(r.indexOf(s),1)}}}},c=function(e,n){var a=n.$scope;if(!n.dragStarted)return void(n.dragDelaying||(n.dragStarted=!0,a.$safeApply(function(){a.$callbacks.dragStart(n.dragInfo)})));if(n.dragElm){e.preventDefault(),n.$window.getSelection?n.$window.getSelection().removeAllRanges():n.$window.document.selection&&n.$window.document.selection.empty();var r=t.eventObj(e),o=r.pageX-n.pos.offsetX,i=r.pageY-n.pos.offsetY;o<0&&(o=0),i<0&&(i=0),i+10>n.document_height&&(i=n.document_height-10),o+10>n.document_width&&(o=n.document_width-10),n.dragElm.css({left:o+a.$callbacks.calsIndent(n.offsetEdge+1,!0,!0)+"px",top:i+"px"}),a.enabledStatus&&a.setPositionStatus(e);var s=window.pageYOffset||n.$window.document.documentElement.scrollTop,c=s+(window.innerHeight||n.$window.document.clientHeight||n.$window.document.clientHeight);if(c<r.pageY&&c<=n.document_height&&window.scrollBy(0,10),s>r.pageY&&window.scrollBy(0,-10),t.positionMoved(e,n.pos,n.firstMoving),n.firstMoving)return void(n.firstMoving=!1);var u,_,g,f,p,m,h,$,b,y,v,D,E=r.pageX-n.$window.document.body.scrollLeft,x=r.pageY-(window.pageYOffset||n.$window.document.documentElement.scrollTop),w=!0,C=!0,S=n.dragInfo,k=S.move,T=S.node,M=S.drop,A=S.target,P=d(e,n);if(P)l=!0,n.dragInfo.__abortDrag=!1;else{if(n.dragInfo.__abortDrag=!0,u=angular.element(n.$window.document.elementFromPoint(E,x)),_=u.scope(),!_)return;D=function(){if(A=_.getScopeTree(),y=S.target,S.target!==A){if(!A.$callbacks.droppable())return!1;y.hidePlace(),y.targeting=!1,A.targeting=!0,S.target=A,n.placeElm=A.initPlace(_.$element,n.dragElm),y=null,$=!0}return!0};var N=function(){n.dragInfo.__abortDrag=!0,l=!1,a.enabledStatus&&a.hideStatus(),a.$$apply=!1};if(angular.isFunction(_.getScopeNode)){if(_=_.getScopeNode(),!D())return}else{if(l)return void setTimeout(function(){A.placeElm.remove(),N()},0);if("TreeDnDNodes"!==_.$type&&"TreeDnD"!==_.$type)return;if(!_.tree_nodes)return;if(0===_.tree_nodes.length){if(!D())return;h=!0}}}if((n.pos.dirAx&&!$||P)&&(C=!1,_=S.scope),_.$element||_){if(p=_.$element.prop("tagName").toLowerCase(),m="tbody"===p||"table"===p||"tr"===p||"td"===p,h)k.parent=null,k.pos=0,M=null;else{if(C){if(u=_.$element,f=t.offset(u),_.horizontal&&!m)g=r.pageX<f.left+t.width(u)/2;else if(m)g=r.pageY<f.top+t.height(u)/2;else{var Y=t.height(u);if(_.getElementChilds()&&(Y-=-t.height(_.getElementChilds())),r.pageY>f.top+Y)return;g=r.pageY<f.top+Y/2}if(!angular.isFunction(_.getData))return;if(y=_.getData(),v=_.getNode(y.__parent_real__),g){var X=_.getPrevSibling(y);k.parent=v,k.pos=angular.isDefined(X)?X.__index__+1:0,M=X}else!y.__expanded__||1===y.__children__.length&&y.__index_real__===T.__parent_real__?(k.parent=v,k.pos=y.__index__+1,M=y):(k.parent=y,k.pos=0,M=null)}else{if(!(n.pos.dirAx&&n.pos.distAxX>=A.dragBorder))return;if(n.pos.distAxX=0,n.pos.distX>0){if(v=M,!v){if(!(k.pos-1>=0))return;v=k.parent.__children__[k.pos-1]}if(S.drag===S.target&&v===T&&a.enabledMove&&(v=A.getPrevSibling(v)),!v||!v.__visible__)return;var O=v.__children__.length;k.parent=v,k.pos=O,M=O>0?v.__children__[O-1]:null}else{if(!(n.pos.distX<0))return;if(y=k.parent,!y||!(0===y.__children__.length||y.__children__.length-1<k.pos||S.drag===S.target&&y.__index_real__===T.__parent_real__&&y.__children__.length-1===T.__index__&&a.enabledMove))return;v=A.getNode(y.__parent_real__),k.parent=v,k.pos=y.__index__+1,M=y}}if(A.onlyDeepestDrop&&M&&T!==M&&(v=M,v&&v.__visible__)){var O=v.__children__.length;k.parent=v,k.pos=O,M=null}}S.drag===S.target&&k.parent&&T.__parent_real__===k.parent.__index_real__&&T.__index__===k.pos&&(w=!1),A.$callbacks.accept(S,k,w)&&(S.move=k,S.drop=M,S.changed=w,S.scope=_,m?(t.replaceIndent(A,n.placeElm,angular.isUndefinedOrNull(k.parent)?1:k.parent.__level__+1),M?(v=(k.parent?k.parent.__children__:null)||S.target.treeData,M.__index__<v.length-1?(M=v[M.__index__+1],b=S.target.getScope(M),b.$element[0].parentNode.insertBefore(n.placeElm[0],b.$element[0])):(y=S.target.getLastDescendant(M),b=S.target.getScope(y),b.$element.after(n.placeElm))):(b=S.target.getScope(k.parent),b&&(k.parent?b.$element.after(n.placeElm):b.getElementChilds().prepend(n.placeElm)))):(b=S.target.getScope(M||k.parent),M?b.$element.after(n.placeElm):b.getElementChilds().prepend(n.placeElm)),A.showPlace(),a.$safeApply(function(){a.$callbacks.dragMove(S)}))}}},a=function(n,t){if(l=!1,n.preventDefault(),t.dragElm){var a=!1,o=t.$scope,i=o.getScope(t.dragInfo.node),d=i.$element.prop("tagName").toLowerCase(),s="tr"===d,c=i.$element;o.$safeApply(function(){a=o.$callbacks.beforeDrop(t.dragInfo)}),s?o.for_all_descendants(t.dragInfo.node,function(e){i=o.getScope(e),c=i.$element,i.$class.hidden&&c.removeClass(o.$class.hidden)}):o.$class.hidden&&c.removeClass(o.$class.hidden),t.dragElm.remove(),t.dragElm=null,o.enabledStatus&&o.hideStatus();var u=!1;o.$$apply?o.$safeApply(function(){t.dragInfo.__multipleNodes=r,e.resetNodesSelected(),t.dragInfo.__abortDrag||(u=o.$callbacks.dropped(t.dragInfo,a,o.enabledMove))}):t&&null===t.pos&&_(t),o.$safeApply(function(){o.$callbacks.dragStop(t.dragInfo,u)}),t.dragInfo.target.hidePlace(),t.dragInfo.target.targeting=!1,t.dragInfo=null,o.$$apply=!1,o.setDragging(null)}angular.element(t.$document).unbind("touchend",t.dragEndEvent),angular.element(t.$document).unbind("touchcancel",t.dragEndEvent),angular.element(t.$document).unbind("touchmove",t.dragMoveEvent),angular.element(t.$document).unbind("mouseup",t.dragEndEvent),angular.element(t.$document).unbind("mousemove",t.dragMoveEvent),angular.element(t.$window.document.body).unbind("mouseleave",t.dragCancelEvent)},u=function(e,n){n.$scope.$callbacks.draggable()&&s(e,n)},_=function(e){e.element.bind("touchstart mousedown",function(t){e.dragDelaying=!0,e.dragStarted=!1,u(t,e),e.dragTimer=n(function(){e.dragDelaying=!1},e.$scope.dragDelay)}),e.element.bind("touchend touchcancel mouseup",function(){n.cancel(e.dragTimer)})},g=function(e,n){var t=n.$scope;if(27===e.keyCode)t.enabledStatus&&t.hideStatus(),t.$$apply=!1,a(e,n);else if(t.enabledHotkey&&e.shiftKey){if(t.enableMove(!0),t.enabledStatus&&t.refreshStatus(),!n.dragInfo)return;var l=t.getScope(n.dragInfo.node),r=l.$element.prop("tagName").toLowerCase(),o=l.$element;"tr"===r?t.for_all_descendants(n.dragInfo.node,function(e){l=t.getScope(e),o=l.$element,t.$class.hidden&&o.addClass(t.$class.hidden)}):t.$class.hidden&&o.addClass(t.$class.hidden)}},f=function(e,n){var t=n.$scope;if(t.enabledHotkey&&!e.shiftKey){if(t.enableMove(!1),t.enabledStatus&&t.refreshStatus(),!n.dragInfo)return;var a=t.getScope(n.dragInfo.node),l=a.$element.prop("tagName").toLowerCase(),r=a.$element;"tr"===l?t.for_all_descendants(n.dragInfo.node,function(e){a=t.getScope(e),r=a.$element,t.$class.hidden&&r.removeClass(t.$class.hidden)}):t.$class.hidden&&r.removeClass(t.$class.hidden)}},p=function(e,n,t,l){var r={hasTouch:"ontouchstart"in window,firstMoving:null,dragInfo:null,pos:null,placeElm:null,dragElm:null,dragDelaying:!0,dragStarted:!1,dragTimer:null,body:document.body,html:document.documentElement,document_height:null,document_width:null,offsetEdge:null,$scope:e,$window:t,$document:l,element:n,bindDrag:function(){_(r)},dragEnd:function(e){a(e,r)},dragMoveEvent:function(e){c(e,r)},dragEndEvent:function(n){e.$$apply=!0,a(n,r)},dragCancelEvent:function(e){a(e,r)}},o=function(e){return g(e,r)},i=function(e){return f(e,r)};e.dragEnd=function(e){r.dragEnd(e)},r.bindDrag(),angular.element(t.document.body).bind("keydown",o),angular.element(t.document.body).bind("keyup",i),e.$on("$destroy",function(){angular.element(t.document.body).unbind("keydown",o),angular.element(t.document.body).unbind("keyup",i),e.statusElm&&e.statusElm.remove(),e.placeElm&&e.placeElm.remove()})};return p}]).factory("$TreeDnDControl",function(e){var n,t,a,l,r=function(e){e.__expanded__=!1},o=function(e){e.__expanded__=!0},i=function(i){var d,s={selected_node:null,for_all_descendants:i.for_all_descendants,select_node:function(e){return e?(e!==s.selected_node&&(s.selected_node&&delete s.selected_node.__selected__,e.__selected__=!0,s.selected_node=e,s.expand_all_parents(e),angular.isFunction(s.on_select)&&s.on_select(e)),e):(s.selected_node&&delete s.selected_node.__selected__,s.selected_node=null,null)},deselect_node:function(){return n=null,s.selected_node&&(delete s.selected_node.__selected__,n=s.selected_node,s.selected_node=null),n},get_parent:function(e){return e&&null!==e.__parent_real__?i.tree_nodes[e.__parent_real__]:null},for_all_ancestors:function(e,n){return t=s.get_parent(e),!t||!n(t)&&s.for_all_ancestors(t,n)},expand_all_parents:function(e){return s.for_all_ancestors(e,o)},reload_data:function(){return i.reload_data()},add_node:function(e,n,t){return"number"!=typeof t?e?(e.__children__.push(n),e.__expanded__=!0):i.treeData.push(n):e?(e.__children__.splice(t,0,n),e.__expanded__=!0):i.treeData.splice(t,0,n),n},add_node_root:function(e){
return s.add_node(null,e),e},expand_all:function(){for(l=i.treeData.length,a=0;a<l;a++)s.for_all_descendants(i.treeData[a],o)},collapse_all:function(){for(l=i.treeData.length,a=0;a<l;a++)s.for_all_descendants(i.treeData[a],r)},remove_node:function(e){e=e||s.selected_node,e&&(t=null!==e.__parent_real__?s.get_parent(e).__children__:i.treeData,t.splice(e.__index__,1),s.selected_node===e&&(s.selected_node=null))},expand_node:function(e){if(e=e||s.selected_node)return e.__expanded__=!0,e},collapse_node:function(e){if(e=e||s.selected_node)return e.__expanded__=!1,e},get_selected_node:function(){return s.selected_node},get_first_node:function(){return l=i.treeData.length,l>0?i.treeData[0]:null},get_children:function(e){return e.__children__},get_siblings:function(e){if(e=e||s.selected_node)return t=s.get_parent(e),n=t?t.__children__:i.treeData},get_next_sibling:function(e){if(e=e||s.selected_node,e&&(n=s.get_siblings(e),d=n.length,e.__index__<d))return n[e.__index__+1]},get_prev_sibling:function(e){if(e=e||s.selected_node,n=s.get_siblings(e),e.__index__>0)return n[e.__index__-1]},get_first_child:function(e){return e=e||s.selected_node,e&&(n=e.__children__,n&&n.length>0)?e.__children__[0]:null},get_closest_ancestor_next_sibling:function(e){return e=e||s.selected_node,(n=s.get_next_sibling(e))?n:(t=s.get_parent(e),s.get_closest_ancestor_next_sibling(t))},get_next_node:function(e){if(e=e||s.selected_node)return n=s.get_first_child(e),n?n:s.get_closest_ancestor_next_sibling(e)},get_prev_node:function(e){if(e=e||s.selected_node)return(n=s.get_prev_sibling(e))?s.get_last_descendant(n):t=s.get_parent(e)},get_last_descendant:i.getLastDescendant,select_parent_node:function(e){if(e=e||s.selected_node,e&&(t=s.get_parent(e)))return s.select_node(t)},select_first_node:function(){return s.select_node(s.get_first_node())},select_next_sibling:function(e){if(e=e||s.selected_node,e&&(n=s.get_next_sibling(e)))return s.select_node(n)},select_prev_sibling:function(e){if(e=e||s.selected_node,e&&(n=s.get_prev_sibling(e)))return s.select_node(n)},select_next_node:function(e){if(e=e||s.selected_node,e&&(n=s.get_next_node(e)))return s.select_node(n)},select_prev_node:function(e){if(e=e||s.selected_node,e&&(n=s.get_prev_node(e)))return s.select_node(n)},reset_selected_nodes:function(n){e.resetNodesSelected()}};return angular.extend(i.tree,s),i.tree};return i}),angular.module("template/TreeDnD/TreeDnD.html",[]).run(["$templateCache",function(e){e.put("template/TreeDnD/TreeDnD.html",['<table ng-class="$tree_class">',"    <thead>","  <tr>",'     <th ng-class="expandingProperty.titleClass" ng-style="expandingProperty.titleStyle">',"         {{expandingProperty.displayName || expandingProperty.field || expandingProperty}}","        </th>",'        <th ng-repeat="col in colDefinitions" ng-class="col.titleClass" ng-style="col.titleStyle">',"         {{col.displayName || col.field}}","     </th>","    </tr>","    </thead>",' <tbody tree-dnd-nodes="tree_nodes">','  <tr tree-dnd-node="node" ng-repeat="node in nodes track by node.__hashKey__ " ng-show="node.__visible__"',"       ng-click=\"onSelect(node)\" ng-class=\"(node.__selected__ ? ' active':'')\">",'        <td ng-if="!expandingProperty.template" tree-dnd-node-handle',"         ng-style=\"expandingProperty.cellStyle ? expandingProperty.cellStyle : {'padding-left': $callbacks.calsIndent(node.__level__)}\"",'          ng-class="expandingProperty.cellClass"','            compile="expandingProperty.cellTemplate">',"              <a data-nodrag>",'                  <i ng-class="$icon_class" ng-click="toggleExpand(node)"','                     class="tree-icon"></i>',"              </a>","             {{node[expandingProperty.field] || node[expandingProperty]}}","       </td>",'        <td ng-if="expandingProperty.template" compile="expandingProperty.template"></td>','        <td ng-repeat="col in colDefinitions" ng-class="col.cellClass" ng-style="col.cellStyle"','            compile="col.cellTemplate">',"            {{node[col.field]}}","       </td>","    </tr>","    </tbody>","</table>"].join("")),e.put("template/TreeDnD/TreeDnDStatusCopy.html",'<label><i class="fa fa-copy"></i>&nbsp;<b>Copying</b></label>'),e.put("template/TreeDnD/TreeDnDStatusMove.html",'<label><i class="fa fa-file-text"></i>&nbsp;<b>Moving</b></label>')}])}).call(window);
//# sourceMappingURL=ng-tree-dnd.min.js.map
